<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>三次多项式轨迹</title>
        <link rel="stylesheet" type="text/css" media="all" href="../../../style.css">
    </head>
    <body class="post-template-default single single-post postid-14 single-format-standard logged-in admin-bar single-author singular two-column left-sidebar customize-support">
        <div id="page" class="hfeed">
            <div id="main">
                <div id="primary">
                    <div id="content" role="main">        
                        <article id="post-14" class="post-14 post type-post status-publish format-standard hentry category-18">
                            <header class="entry-header">
                                <h1 class="entry-title">三次多项式轨迹</h1>
                            </header>
                            <div class="entry-content">
<br><a href="../../../index.html"> Home </a> 
<br>
<br>
<p>
<br><a href="#THIRD">三次多项式轨迹</a>
<br><a href="#FIVE">五次多项式轨迹</a>
<br><a href="#SEVEN">七次多项式轨迹</a>
<br><a href="#SPLINE">三次样条曲线</a>
<br><a href="#SCURVE">基于S型曲线的连续多段曲线插补平滑过渡的规划算法</a>
<br><div id="THIRD"><strong>三次多项式轨迹</strong></div>


<p data-first-child data-pid="ODmVmsYC"><b>三次多项式轨迹</b></p><br><img src="v2-9079350c42e81a5a905fc847e573de74_720w.jpg" ><br><img src="v2-e25aa755c8da358e982916fdb35e7fda_720w.jpg" ><br><img src="v2-87e58ebf79dc7500dda55b82ad43e77f_720w.jpg" ><br><img src="v2-087c05bbb93b46ceaf8024629d7ce499_720w.jpg" ><p data-pid="frdqh6kH">matlab仿真代码参见examplesCode文件夹下的example2_6.m文件</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%example2.6</span>
<span class="n">clc</span>
<span class="n">clear</span>
<span class="c">%轨迹定义条件</span>
<span class="c">%时间</span>
<span class="n">t0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">t1</span><span class="p">=</span><span class="mi">8</span><span class="p">;</span>
<span class="c">%位置和速度（a）</span>
<span class="n">q0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">q1</span><span class="p">=</span><span class="mi">10</span><span class="p">;</span>
<span class="n">v0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">v1</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="c">%利用公式（1-22）求系数</span>
<span class="n">h</span><span class="p">=</span><span class="n">q1</span><span class="o">-</span><span class="n">q0</span><span class="p">;</span>
<span class="n">T</span><span class="p">=</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">;</span>
<span class="n">a0</span><span class="p">=</span><span class="n">q0</span><span class="p">;</span>
<span class="n">a1</span><span class="p">=</span><span class="n">v0</span><span class="p">;</span>
<span class="n">a2</span><span class="p">=(</span><span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">v0</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">);</span>
<span class="n">a3</span><span class="p">=(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="p">(</span><span class="n">v0</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">);</span>
<span class="c">%轨迹生成</span>
<span class="n">t</span><span class="p">=</span><span class="n">t0</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="n">t1</span><span class="p">;</span>
<span class="c">%位置</span>
<span class="n">q</span><span class="p">=</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span>
<span class="c">%速度</span>
<span class="n">v</span><span class="p">=</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>
<span class="c">%加速度</span>
<span class="n">acc</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;(a)&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>

<span class="c">%时间</span>
<span class="n">t0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">t1</span><span class="p">=</span><span class="mi">8</span><span class="p">;</span>
<span class="c">%位置和速度（b）</span>
<span class="n">q0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">q1</span><span class="p">=</span><span class="mi">10</span><span class="p">;</span>
<span class="n">v0</span><span class="p">=</span><span class="o">-</span><span class="mi">5</span><span class="p">;</span>
<span class="n">v1</span><span class="p">=</span><span class="o">-</span><span class="mi">10</span><span class="p">;</span>
<span class="c">%利用公式（1-22）求系数</span>
<span class="n">h</span><span class="p">=</span><span class="n">q1</span><span class="o">-</span><span class="n">q0</span><span class="p">;</span>
<span class="n">T</span><span class="p">=</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">;</span>
<span class="n">a0</span><span class="p">=</span><span class="n">q0</span><span class="p">;</span>
<span class="n">a1</span><span class="p">=</span><span class="n">v0</span><span class="p">;</span>
<span class="n">a2</span><span class="p">=(</span><span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">v0</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">);</span>
<span class="n">a3</span><span class="p">=(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="p">(</span><span class="n">v0</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">);</span>
<span class="c">%轨迹生成</span>
<span class="n">t</span><span class="p">=</span><span class="n">t0</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="n">t1</span><span class="p">;</span>
<span class="c">%位置</span>
<span class="n">q</span><span class="p">=</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span>
<span class="c">%速度</span>
<span class="n">v</span><span class="p">=</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>
<span class="c">%加速度</span>
<span class="n">acc</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;(b)&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span></code></pre></div><br><img src="v2-5ef45055a7651ee8b29341ab05c7bf4b_720w.jpg" ><p data-pid="g2E1qdd4">matlab仿真代码参见examplesCode文件夹下的example2_7.m文件</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%example2.7</span>
<span class="n">clc</span>
<span class="n">clear</span>
<span class="c">%轨迹定义条件</span>
<span class="n">t_array</span><span class="p">=[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">];</span>
<span class="n">q_array</span><span class="p">=[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">];</span>
<span class="n">v_array</span><span class="p">=[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="c">%计算轨迹</span>
<span class="c">%初始位置</span>
<span class="n">t</span><span class="p">=</span><span class="n">t_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">q</span><span class="p">=</span><span class="n">q_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">v</span><span class="p">=</span><span class="n">v_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="c">%计算各段轨迹</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="c">%计算各段多项式的系数</span>
    <span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a0</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">v_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)=(</span><span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">v_array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">v_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
    <span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)=(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">v_array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">v_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>

    <span class="c">%生成各段轨迹密化的数据点</span>
    <span class="c">%局部时间坐标</span>
    <span class="n">tau</span><span class="p">=</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">):</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">:</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="c">%全局时间坐标，由局部时间坐标组成</span>
    <span class="n">t</span><span class="p">=[</span><span class="n">t</span><span class="p">,</span><span class="n">tau</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%局部位置坐标</span>
    <span class="n">qk</span><span class="p">=</span><span class="n">a0</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span>
    <span class="c">%全局位置坐标</span>
    <span class="n">q</span><span class="p">=[</span><span class="n">q</span><span class="p">,</span><span class="n">qk</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%速度</span>
    <span class="n">vk</span><span class="p">=</span><span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">v</span><span class="p">=[</span><span class="n">v</span><span class="p">,</span><span class="n">vk</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%加速度</span>
    <span class="n">acck</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">acc</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">acc</span><span class="p">=[</span><span class="n">acc</span><span class="p">,</span><span class="n">acck</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
<span class="k">end</span>
<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">h1</span><span class="p">=</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;-r&#39;</span><span class="p">);</span>
<span class="n">legend</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span><span class="s">&#39;第一种方式&#39;</span><span class="p">)</span>
<span class="n">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_array</span><span class="p">,</span><span class="n">q_array</span><span class="p">,</span><span class="s">&#39;or&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">45</span><span class="p">]);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_array</span><span class="p">,</span><span class="n">v_array</span><span class="p">,</span><span class="s">&#39;ob&#39;</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">]);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="mi">45</span><span class="p">]);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span><span class="p">;</span></code></pre></div><br><img src="v2-ae53b3088900278c5b35b959d9a5b006_720w.jpg" ><p data-pid="OWuQ7zUp">matlab仿真代码参见examplesCode文件夹下的example2_8.m文件</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%example2.8</span>
<span class="n">clc</span>
<span class="n">clear</span>
<span class="c">%轨迹定义条件</span>
<span class="n">t_array</span><span class="p">=[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">];</span>
<span class="n">q_array</span><span class="p">=[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">];</span>
<span class="n">v_array</span><span class="p">=[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="c">%计算轨迹</span>
<span class="c">%初始位置</span>
<span class="n">t</span><span class="p">=</span><span class="n">t_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">q</span><span class="p">=</span><span class="n">q_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">v</span><span class="p">=</span><span class="n">v_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">v_array2</span><span class="p">=</span><span class="n">v_array</span><span class="p">;</span>

<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="c">%按照式（1-23）式确定中间点的速度值</span>
    <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dk1</span><span class="p">=(</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">dk2</span><span class="p">=(</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
        <span class="k">if</span><span class="p">((</span><span class="n">dk2</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dk1</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">dk2</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dk1</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">dk1</span><span class="o">+</span><span class="n">dk2</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">end</span>  
    <span class="k">end</span>
<span class="k">end</span>

<span class="c">%计算各段轨迹</span>
<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="c">%计算各段多项式的系数</span>
    <span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a0</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)=(</span><span class="mi">3</span><span class="o">*</span><span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
    <span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)=(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>

    <span class="c">%生成各段轨迹密化的数据点</span>
    <span class="c">%局部时间坐标</span>
    <span class="n">tau</span><span class="p">=</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">):</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">:</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="c">%全局时间坐标，由局部时间坐标组成</span>
    <span class="n">t</span><span class="p">=[</span><span class="n">t</span><span class="p">,</span><span class="n">tau</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%局部位置坐标</span>
    <span class="n">qk</span><span class="p">=</span><span class="n">a0</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span>
    <span class="c">%全局位置坐标</span>
    <span class="n">q</span><span class="p">=[</span><span class="n">q</span><span class="p">,</span><span class="n">qk</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%速度</span>
    <span class="n">vk</span><span class="p">=</span><span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">v</span><span class="p">=[</span><span class="n">v</span><span class="p">,</span><span class="n">vk</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%加速度</span>
    <span class="n">acck</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">acc</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">acc</span><span class="p">=[</span><span class="n">acc</span><span class="p">,</span><span class="n">acck</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
<span class="k">end</span>
<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">h2</span><span class="p">=</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;--r&#39;</span><span class="p">);</span>
<span class="n">legend</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span><span class="s">&#39;第二种方式&#39;</span><span class="p">)</span>
<span class="n">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_array</span><span class="p">,</span><span class="n">q_array</span><span class="p">,</span><span class="s">&#39;^r&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">45</span><span class="p">]);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_array</span><span class="p">,</span><span class="n">v_array2</span><span class="p">,</span><span class="s">&#39;^b&#39;</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;--b&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">]);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span><span class="p">;</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;--g&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="mi">45</span><span class="p">]);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span><span class="p">;</span></code></pre></div><h2>小结</h2><p data-pid="RkQ3p9He">前面所述的三次多项式实际是速度规划里面常说的PVT算法。PVT 模 式 是 指 位 置 — 速 度 — 时 间（Position-Velocity-Time）模式。PVT模式是一种简单又有效的运动控制模式，用户只需要给定离散点的位置、速度和时间，运动控制卡的插补算法将会生成一条连续、平滑的运动路径。</p><p data-pid="WYA3rDHD">PVT 算法除了给定各数据点的“位置、速度、时间”之外，还可以通过其他形式给出参数。根据输入参数的不同，PVT 算法可分为 PVT 描述方式、Complete  描述方式、Percent 描述方式和 Continuous 描述方式。</p><p data-pid="LIlnPYFX">前面所述的三次多项式实际是PVT描述方式，PVT描述方式直接给定各数据点的“位置、速度、时间”。一般使用多项式插值，若用三次多项式表示位移-时间关系，每两个相邻数据点可单独确定一个三次曲线。没有限制各段之间的衔接条件，不能保证各个点处速度曲线平滑过渡，因此不能保证加速度连续。其他描述方式后面会逐渐介绍。</p><p data-pid="9iQdSnU2">参考文献</p><p data-pid="khuDpXJs">[1]Biagiotti L, Melchiorri C. Trajectory Planning for Automatic Machines and Robots[M]. Springer Berlin Heidelberg, 2009.</p><p data-pid="jKk3p_PN">[2]东梁. 嵌入式运动控制器若干关键技术的研究与实现[D].2015.</p>
<br><div id="FIVE"><strong>五次多项式轨迹</strong></div>
<h2 data-first-child>多项式轨迹--五次多项式</h2><br><img src="v2-cb58a0a6eeec2e5b47873fdcfa63f0f8_720w.jpg" ><br><img src="v2-360f6e3cebb0d1be50bba5da507074ff_720w.jpg" ><p data-pid="PlXW7Vm_">matlab仿真代码参见examplesCode文件夹下的example2_9.m文件</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%example2.9</span>
<span class="n">clc</span>
<span class="n">clear</span>
<span class="c">%轨迹定义条件</span>
<span class="c">%时间</span>
<span class="n">t0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">t1</span><span class="p">=</span><span class="mi">8</span><span class="p">;</span>
<span class="c">%位置和速度（a）</span>
<span class="n">q0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">q1</span><span class="p">=</span><span class="mi">10</span><span class="p">;</span>
<span class="n">v0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">v1</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">acc0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">acc1</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="c">%利用公式（1-25）求系数</span>
<span class="n">h</span><span class="p">=</span><span class="n">q1</span><span class="o">-</span><span class="n">q0</span><span class="p">;</span>
<span class="n">T</span><span class="p">=</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">;</span>
<span class="n">a0</span><span class="p">=</span><span class="n">q0</span><span class="p">;</span>
<span class="n">a1</span><span class="p">=</span><span class="n">v0</span><span class="p">;</span>
<span class="n">a2</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">acc0</span><span class="p">;</span>
<span class="n">a3</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">v1</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">acc1</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">acc0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">));</span>
<span class="n">a4</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">v1</span><span class="o">+</span><span class="mi">16</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">acc0</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">acc1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">));</span>
<span class="n">a5</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v0</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">acc1</span><span class="o">-</span><span class="n">acc0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">));</span>
<span class="c">%轨迹生成</span>
<span class="n">t</span><span class="p">=</span><span class="n">t0</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="n">t1</span><span class="p">;</span>
<span class="c">%位置</span>
<span class="n">q</span><span class="p">=</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="c">%速度</span>
<span class="n">v</span><span class="p">=</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="mi">5</span><span class="o">*</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="c">%加速度</span>
<span class="n">acc</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">2.5</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;(a)&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>

<span class="c">%时间</span>
<span class="n">t0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">t1</span><span class="p">=</span><span class="mi">8</span><span class="p">;</span>
<span class="c">%位置和速度（a）</span>
<span class="n">q0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">q1</span><span class="p">=</span><span class="mi">10</span><span class="p">;</span>
<span class="n">v0</span><span class="p">=</span><span class="o">-</span><span class="mi">5</span><span class="p">;</span>
<span class="n">v1</span><span class="p">=</span><span class="o">-</span><span class="mi">10</span><span class="p">;</span>
<span class="n">acc0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">acc1</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="c">%利用公式（1-25）求系数</span>
<span class="n">h</span><span class="p">=</span><span class="n">q1</span><span class="o">-</span><span class="n">q0</span><span class="p">;</span>
<span class="n">T</span><span class="p">=</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">;</span>
<span class="n">a0</span><span class="p">=</span><span class="n">q0</span><span class="p">;</span>
<span class="n">a1</span><span class="p">=</span><span class="n">v0</span><span class="p">;</span>
<span class="n">a2</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">acc0</span><span class="p">;</span>
<span class="n">a3</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">v1</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">acc1</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">acc0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">));</span>
<span class="n">a4</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">v1</span><span class="o">+</span><span class="mi">16</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">acc0</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">acc1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">));</span>
<span class="n">a5</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v0</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">acc1</span><span class="o">-</span><span class="n">acc0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="p">));</span>
<span class="c">%轨迹生成</span>
<span class="n">t</span><span class="p">=</span><span class="n">t0</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="n">t1</span><span class="p">;</span>
<span class="c">%位置</span>
<span class="n">q</span><span class="p">=</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="c">%速度</span>
<span class="n">v</span><span class="p">=</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="mi">5</span><span class="o">*</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="c">%加速度</span>
<span class="n">acc</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;(b)&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span></code></pre></div><p data-pid="P-35HK7C">Example 2.10:对于example2.7、example2.8 的条件（参见上一篇博客<a href="https://link.zhihu.com/?target=http%3A//blog.csdn.net/libing403/article/details/78698322" class=" wrap external" target="_blank" rel="nofollow noreferrer">轨迹规划--三次多项式轨迹</a>）使用五次多项式确定轨迹，如下图所示。并与example2.8对比，发现“平滑度”得到了改善。</p><br><img src="v2-6bbb7f521068cd3dbe2294b2c223e8bb_720w.jpg" ><br><img src="v2-4eb223026ba65de21e67568962b4373a_720w.jpg" ><p data-pid="stvKg7wj">图8 Example2.7的条件用五次多项式确定的轨迹</p><p data-pid="VrgJfdYV">matlab仿真代码参见examplesCode文件夹下的example2_10.m文件</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%example2.10</span>
<span class="n">clc</span>
<span class="n">clear</span>
<span class="n">close</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">)</span>
<span class="c">%轨迹定义条件</span>
<span class="c">%时间、位置和速度（a）</span>
<span class="n">t_array</span><span class="p">=[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">];</span>
<span class="n">q_array</span><span class="p">=[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">];</span>
<span class="n">v_array</span><span class="p">=[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="c">%起点和终点加速度假设为0，中间点加速度都初始化为0，</span>
<span class="n">acc_array</span><span class="p">=[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
<span class="c">%计算轨迹</span>
<span class="c">%初始位置</span>
<span class="n">t</span><span class="p">=</span><span class="n">t_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">q</span><span class="p">=</span><span class="n">q_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">v</span><span class="p">=</span><span class="n">v_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">v_array2</span><span class="p">=</span><span class="n">v_array</span><span class="p">;</span>
<span class="n">acc</span><span class="p">=</span><span class="n">acc_array</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="c">%按照式（1-23）式确定中间点的速度值</span>
    <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dk1</span><span class="p">=(</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">dk2</span><span class="p">=(</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
        <span class="k">if</span><span class="p">((</span><span class="n">dk2</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dk1</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">dk2</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">dk1</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">dk1</span><span class="o">+</span><span class="n">dk2</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">end</span>  
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">k</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="c">%利用公式（1-25）求系数</span>

    <span class="c">%计算各段多项式的系数</span>
    <span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a0</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">q_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">acc_array</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">acc_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">acc_array</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)));</span>
    <span class="n">a4</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="o">*</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">acc_array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">acc_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)));</span>
    <span class="n">a5</span><span class="p">(</span><span class="n">k</span><span class="p">)=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">h</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">v_array2</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">acc_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">acc_array</span><span class="p">(</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)));</span>

    <span class="c">%生成各段轨迹密化的数据点</span>
    <span class="c">%局部时间坐标</span>
    <span class="n">tau</span><span class="p">=</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="p">):</span><span class="n">T</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">:</span><span class="n">t_array</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="c">%全局时间坐标，由局部时间坐标组成</span>
    <span class="n">t</span><span class="p">=[</span><span class="n">t</span><span class="p">,</span><span class="n">tau</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%位置</span>
    <span class="n">qk</span><span class="p">=</span><span class="n">a0</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
        <span class="n">a4</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">a5</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">5</span><span class="p">);</span>
     <span class="c">%全局位置坐标</span>
    <span class="n">q</span><span class="p">=[</span><span class="n">q</span><span class="p">,</span><span class="n">qk</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%速度</span>
    <span class="n">vk</span><span class="p">=</span><span class="n">a1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">a4</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
        <span class="mi">5</span><span class="o">*</span><span class="n">a5</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">4</span><span class="p">);</span>
     <span class="n">v</span><span class="p">=[</span><span class="n">v</span><span class="p">,</span><span class="n">vk</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>
    <span class="c">%加速度</span>
    <span class="n">acck</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">a4</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">a5</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tau</span><span class="o">-</span><span class="n">tau</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">acc</span><span class="p">=[</span><span class="n">acc</span><span class="p">,</span><span class="n">acck</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)];</span>

<span class="k">end</span>
<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_array</span><span class="p">,</span><span class="n">q_array</span><span class="p">,</span><span class="s">&#39;o&#39;</span><span class="p">);</span>
 <span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">45</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_array</span><span class="p">,</span><span class="n">v_array2</span><span class="p">,</span><span class="s">&#39;o&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span><span class="mi">35</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span></code></pre></div><p data-pid="mUDg1Pmz">参考文献</p><p data-pid="iPNGLz82">Biagiotti L, Melchiorri C. Trajectory Planning for Automatic Machines and Robots[M]. Springer Berlin Heidelberg, 2009.</p>
<br><div id="SEVEN"><strong>七次多项式轨迹</strong></div>
<h2 data-first-child>多项式轨迹--七次多项式</h2><br><img src="v2-89676de08f77943240e3833c086393bf_720w.jpg"><p data-pid="NZQhA5Qz">matlab仿真代码参见examplesCode文件夹下的example2_11.m文件 </p><div class="highlight"><pre><code class="language-matlab"><span class="c">%example2.11,七次多项式轨迹</span>
<span class="n">clc</span>
<span class="n">clear</span>
<span class="n">close</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">)</span>
<span class="c">%轨迹定义条件</span>
<span class="n">t0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="n">t1</span><span class="p">=</span><span class="mi">8</span><span class="p">;</span>
<span class="n">q0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="n">q1</span><span class="p">=</span><span class="mi">10</span><span class="p">;</span>
<span class="n">v0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="n">v1</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">acc0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="n">acc1</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">j0</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j1</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
<span class="c">%利用（1-26）式求系数</span>
<span class="n">h</span><span class="p">=</span><span class="n">q1</span><span class="o">-</span><span class="n">q0</span><span class="p">;</span>
<span class="n">T</span><span class="p">=</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">;</span>

<span class="n">a0</span><span class="p">=</span><span class="n">q0</span><span class="p">;</span>
<span class="n">a1</span><span class="p">=</span><span class="n">v0</span><span class="p">;</span>
<span class="n">a2</span><span class="p">=</span><span class="n">acc0</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="n">a3</span><span class="p">=</span><span class="n">j0</span><span class="o">/</span><span class="mi">6</span><span class="p">;</span>
<span class="n">a4</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">210</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="n">T</span><span class="o">*</span><span class="p">((</span><span class="mi">30</span><span class="o">*</span><span class="n">acc0</span><span class="o">-</span><span class="mi">15</span><span class="o">*</span><span class="n">acc1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">j0</span><span class="o">+</span><span class="n">j1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="mi">120</span><span class="o">*</span><span class="n">v0</span><span class="o">+</span><span class="mi">90</span><span class="o">*</span><span class="n">v0</span><span class="p">));</span>
<span class="n">a5</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">168</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="n">T</span><span class="o">*</span><span class="p">((</span><span class="mi">20</span><span class="o">*</span><span class="n">acc0</span><span class="o">-</span><span class="mi">14</span><span class="o">*</span><span class="n">acc1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">j0</span><span class="o">+</span><span class="n">j1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="mi">90</span><span class="o">*</span><span class="n">v0</span><span class="o">+</span><span class="mi">78</span><span class="o">*</span><span class="n">v1</span><span class="p">));</span>
<span class="n">a6</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">420</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="n">T</span><span class="o">*</span><span class="p">((</span><span class="mi">45</span><span class="o">*</span><span class="n">acc0</span><span class="o">-</span><span class="mi">39</span><span class="o">*</span><span class="n">acc1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">j0</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">j1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="mi">216</span><span class="o">*</span><span class="n">v0</span><span class="o">+</span><span class="mi">204</span><span class="o">*</span><span class="n">v1</span><span class="p">));</span>
<span class="n">a7</span><span class="p">=</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="n">T</span><span class="o">*</span><span class="p">((</span><span class="mi">12</span><span class="o">*</span><span class="n">acc0</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">acc1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="p">(</span><span class="n">j0</span><span class="o">+</span><span class="n">j1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">T</span><span class="o">+</span><span class="mi">60</span><span class="o">*</span><span class="n">v0</span><span class="o">+</span><span class="mi">60</span><span class="o">*</span><span class="n">v1</span><span class="p">));</span>
<span class="c">%计算轨迹</span>
<span class="n">t</span><span class="p">=</span><span class="nb">linspace</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="c">%位置</span>
<span class="n">q</span><span class="p">=</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="o">+</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="n">a6</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="n">a7</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
<span class="c">%速度</span>
<span class="n">v</span><span class="p">=</span><span class="n">a1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">a6</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="mi">7</span><span class="o">*</span><span class="n">a7</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
<span class="c">%加速度</span>
<span class="n">acc</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="mi">6</span><span class="o">*</span><span class="n">a6</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="mi">7</span><span class="o">*</span><span class="n">a7</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="c">%加加速度</span>
<span class="nb">j</span><span class="p">=</span><span class="mi">2</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">a4</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="n">a5</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="c">...</span>
    <span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">*</span><span class="mi">6</span><span class="o">*</span><span class="n">a6</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="mi">6</span><span class="o">*</span><span class="mi">7</span><span class="o">*</span><span class="n">a7</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>

<span class="c">%绘图</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span>
 <span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;velocity&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">acc</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acceleration&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">);</span>
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;jerk&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span></code></pre></div><p data-pid="xyrgu_2L">参考文献：</p><p data-pid="4PcprH3B">[1]Biagiotti L, Melchiorri C. Trajectory Planning for Automatic Machines and Robots[M]. Springer Berlin Heidelberg, 2009.</p>
<br><div id="SPLINE"><strong>三次样条曲线</strong></div>
<p data-first-child data-pid="Ju-fuhL2">写在前面</p><p data-pid="X7H0biBE">在一些避障的应用场景下，一般都是先在任务空间中对多轴机械臂的末端进行<b>路径规划</b>，得到的是末端的运动路径点数据。这条轨迹只包含位置关系，并没有告诉机器人应该以怎样的速度、加速度运动，这就需要进行带时间参数的<b>轨迹规划处理</b>，也就是对这条空间轨迹进行速度、加速度约束，并且计算运动到每个路点的时间，高级的算法有TOPP等，一般的呢就是贝塞尔、三次准/非/均匀B、五次及三次样条等。下面从最简单的三次样条开始讨论。</p><h2>三次样条曲线性质</h2><p data-pid="Kbl1D6Dt">当给出n+1个点时，可以使用n个p次多项式（通常较低）代替唯一的n次插值多项式，每个多项式定义一段轨迹。以这种方式定义的总函数s（t）称为p阶的样条曲线。p的值是根据所需的样条连续度来选择的。例如，为了在两个连续段之间发生过渡的时刻tk获得速度和加速度的连续性，可以假定多项式的阶数p＝3（三次多项式）。</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-3824f285cc2804f9d7d88e270b0bf98d_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="tBuLDO2j">定义三次样条曲线的函数形式为：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-4e3d1fa6fc89b6b3e9b862659e222556_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="aXQh3hv5">这段轨迹由n个三次多项式构成，并且每个多项式需要计算四个参数。由于n个多项式是定义一条通过n+1点的轨迹所必需的，因此需要确定的系数总数为4n。为了解决这个问题，必须考虑以下条件：</p><ul><li data-pid="_LEWu5AO"> 给定点插值的2n条件，因为每一个三次函数必须在其极值处穿过点。<br/> </li><li data-pid="zXiFGOsr"> n-1个条件，过渡点的速度要连续；<br/> </li><li data-pid="R6vyPJZ1"> n-1个条件，过渡点的加速度要连续；<br/> </li></ul><p data-pid="ARf5EslN">这样的话，就已经限制了2n+2(n-1)个条件，还剩下2个自由度还未限制。通过前面分析，还需要两个限制条件才行，这里讨论的就是初始点和终点的速度以及加速度。下面是几种可能的选择，可以任意选择：</p><br><img src="v2-5f7a90e089362a9886f7cac1cdb59ae2_720w.jpg" ><br><img src="v2-2e3b6bcf6e1d96bd8c7b48e8dc61694a_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="yPGAfdFO">通常情况，样条曲线具有如下几个特性：</p><ul><li data-pid="3W6oNAQ_"> 对于由给定点(tk,qk),k=0,…n得到的p阶样条曲线s(t)，[n(p+1)]个参数可以确定<br/> </li><li data-pid="C2Zu0OS9"> 给定n+1个点，并且给定边界条件，则p阶插值样条曲线s(t)能被唯一确定<br/> </li><li data-pid="2DF8qGxV"> 用于构造样条曲线的多项式的阶数p不取决于数据点的数目<br/> </li><li data-pid="Dl0t61rL"> 函数s(t)p-1阶连续可导<br/> </li><li data-pid="UTGGTPI-"> 自然样条曲线是指初始加速度和最终加速度均为0的样条曲线<br/> </li></ul><h2>当指定初始速度v0和最终速度vn时的参数计算（也就是v0和vn已知）</h2><p data-pid="p1zLr5az">在定义自动机械的轨迹时，速度剖面的连续性条件至关重要。因此，计算样条曲线的典型选择是指定初始和最终速度v0和vn。因此，给定点(tk,qk),k=0,…n以及速度的边界条件（初始速度和最终速度）v0,vn，就有如下几个条件成立：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-d849a9da1cb02ba6244b5bf0894c0a71_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="n8jrlw8K">可以最终确定样条曲线的函数s(t)为</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-be66585f5e70185fc29e7c578c069a66_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="kzpY9XsW">系数ak,i可以由以下算法进行确定：</p><p data-pid="VxDWXwiz">第一种情况，如果中间点（插补点）的速度我们已知，也就是vk,k=1,…,n-1，对于每段三次样条曲线，有</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-12c84639d913550e7e25698cfeb1a549_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="sVBpgVeB">其中，$T_{k}=t_{k+1}-t_{k}$。通过解上面的方程，可以得到</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-0d6d3e7d3afae9cf553d16429477fe23_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="BLqq4vaN">这就可以把每一段曲线的系数都求出来，从而得到样条曲线。这是最简单的情况！</p><p data-pid="u80ewRPZ">子函数如下：</p><div class="highlight"><pre><code class="language-matlab"><span class="c">% 三次样条：指定初始速度v0和终止速度vn，并且中间插补点的速度已知，这是最简单的情况</span>
<span class="c">% Input：</span>
<span class="c">%   q：给定点的位置</span>
<span class="c">%   t：给定点位置对应的时间</span>
<span class="c">%   v：包括给定起始、中间及终止速度的速度向量</span>
<span class="c">%   tt：插补周期</span>
<span class="c">% Output：</span>
<span class="c">%   yy dyy ddyy：样条曲线函数值、速度、加速度值</span>
<span class="k">function</span><span class="w"> </span>[yy dyy ddyy] <span class="p">=</span><span class="w"> </span><span class="nf">cubicSpline_1</span><span class="p">(</span>q, t, v, tt<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">~=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&#39;输入的数据应成对&#39;</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="n">T</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c">% 运行总时长</span>
<span class="n">nn</span> <span class="p">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">tt</span><span class="p">;</span> <span class="c">% 总点数</span>
<span class="n">yy</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>
<span class="n">dyy</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>
<span class="n">ddyy</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>
<span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">Tk</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="n">a0</span> <span class="p">=</span> <span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="n">a1</span> <span class="p">=</span> <span class="n">v</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="n">a2</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">Tk</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)))</span><span class="o">/</span><span class="n">Tk</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">a3</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Tk</span><span class="o">*</span><span class="n">Tk</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span><span class="o">/</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">v</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>

    <span class="k">for</span> <span class="n">tk</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">):</span> <span class="n">tt</span><span class="p">:</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">tk</span> <span class="o">==</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">end</span>
        <span class="n">yy</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
        <span class="n">dyy</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">ddyy</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
        <span class="nb">j</span> <span class="p">=</span> <span class="nb">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">end</span></code></pre></div><p data-pid="xtVgF7Xn">第二种情况，如果中间点的速度我们未知，也就是vk,k=1,…,n-1均未知，然而这些值是必须被计算的。为此，考虑了中间加速度的连续条件：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-36f8f4ded594ca4335bc3a9b894ce326_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="FdTQuIPB">在这些条件下，通过考虑参数$a_{k, 2}, \quad a_{k, 3}, \quad a_{k+1,2}$的表达式乘以$\left(T_{k} T_{k+1}\right) / 2$，在简单计算整理之后能够得到</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-e44ebe9050c18b824dc7c0f94d57301e_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="6xG9jHZ2">其中k=0,…,n-2。</p><p data-pid="T91ukEjf">上面的关系可以整理成矩阵的形式，$A^{\prime} v^{\prime}=c^{\prime}$，其中</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-d23266638561838b46c766b732466b8f_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-8da8b6847a67481dad05a83018a14722_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="E2ZfK22a">其中常数项ck仅取决于中间位置和已知的样条曲线段的持续时间Tk。由于速度v0和vn也是已知的，所以可以消除矩阵A‘的相应列并获得</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-0bd45f99791f82c13e10d5535620301b_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="S63mR3J2">也就是</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-dd387548f0e7c7821a8e3bb47fa1632b_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-1885955e49f6493c58fe1ddfb6b628d2_720w.jpg" ><h3>例子</h3><br><img src="v2-9285e8e89c22e7af806d426d15c26450_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="zyfJrdGG">另外v0=2，v6=-3。</p><div class="highlight"><pre><code class="language-matlab"><span class="c">% 三次样条：指定初始速度v0和终止速度vn，但是中间点速度未知</span>
<span class="c">% Input：</span>
<span class="c">%   q：给定点的位置</span>
<span class="c">%   t：给定点位置对应的时间</span>
<span class="c">%   v0：初始速度</span>
<span class="c">%   vn：终止速度</span>
<span class="c">%   tt：插补周期</span>
<span class="c">% Output：</span>
<span class="c">%   yy dyy ddyy：样条曲线函数值、速度、加速度值</span>
<span class="k">function</span><span class="w"> </span>[yy dyy ddyy] <span class="p">=</span><span class="w"> </span><span class="nf">cubicSpline_2</span><span class="p">(</span>q, t, v0, vn, tt<span class="p">);</span>
<span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">~=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&#39;输入的数据应成对&#39;</span><span class="p">);</span>
<span class="k">end</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="n">c</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c">% 矩阵A是个(n-2)*(n-2)的对角占优矩阵</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
    <span class="n">Tk_1</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">Tk</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">Tk</span><span class="o">*</span><span class="n">Tk_1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="n">Tk_1</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)))</span> <span class="o">-</span> <span class="n">Tk_1</span><span class="o">*</span><span class="n">v0</span><span class="p">;</span>
    <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">Tk</span><span class="o">*</span><span class="n">Tk_1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="n">Tk_1</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)))</span> <span class="o">-</span> <span class="n">Tk</span><span class="o">*</span><span class="n">vn</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">Tk</span><span class="o">*</span><span class="n">Tk_1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="n">Tk_1</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)));</span>

    <span class="k">end</span>
<span class="k">end</span>
<span class="c">% 经过上述步骤得到对角占优矩阵A和c</span>
<span class="c">% vk = A \ c; % 这一步matlab计算很慢，应换成追赶法求vk</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
    <span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span> <span class="c">% 对角线</span>
    <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">3</span>
        <span class="n">b</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c">% 上边</span>
        <span class="n">d</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span> <span class="c">% 下边</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="k">elseif</span> <span class="nb">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
        <span class="n">b</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c">% 上边</span>
        <span class="n">d</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span> <span class="c">% 下边</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="p">[</span><span class="o">~</span><span class="p">,</span> <span class="o">~</span><span class="p">,</span> <span class="n">vk</span><span class="p">]</span> <span class="p">=</span> <span class="n">crout</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span> <span class="c">% 追赶法</span>

<span class="c">% 得到中间插补点的速度vk，然后调用cubicSpline_1即可</span>
<span class="n">v_</span> <span class="p">=</span> <span class="p">[</span><span class="n">v0</span><span class="p">,</span> <span class="n">vk</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">vn</span><span class="p">];</span>
<span class="p">[</span><span class="n">yy</span> <span class="n">dyy</span> <span class="n">ddyy</span><span class="p">]</span> <span class="p">=</span> <span class="n">cubicSpline_1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v_</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>

<span class="k">end</span>


<span class="c">%追赶法求解三对角线性方程组，Ax=b，A用一维数组a，c，d存储。</span>
<span class="k">function</span><span class="w"> </span>[L,U,x]<span class="p">=</span><span class="nf">crout</span><span class="p">(</span>a,c,d,b<span class="p">)</span><span class="c">%数组a存储三角矩阵A的主对角线元素，c、d存储主对角线上边下边带宽为1的元素</span>
    <span class="n">n</span><span class="p">=</span><span class="nb">length</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="n">n1</span><span class="p">=</span><span class="nb">length</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">n2</span><span class="p">=</span><span class="nb">length</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
    <span class="c">%错误检查</span>
    <span class="k">if</span> <span class="n">n1</span><span class="o">~=</span><span class="n">n2</span><span class="c">%存储矩阵的数组维数错误</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&#39;MATLAB:Crout:不是三对角矩阵，参数数组中元素个数错误.&#39;</span><span class="p">);</span>
    <span class="k">elseif</span> <span class="n">n</span><span class="o">~=</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&#39;MATLAB:Crout:不是三对角矩阵，参数数组中元素个数错误.&#39;</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="c">%初始化</span>
    <span class="n">L</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="c">%生成n*n的全零矩阵</span>
    <span class="n">U</span><span class="p">=</span><span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">p</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">;</span>
    <span class="n">q</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">x</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">;</span>
    <span class="n">y</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">;</span>

    <span class="c">%追赶法程序主体</span>
    <span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">)=</span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)=</span><span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
        <span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)=</span><span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">d</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span><span class="c">%d的下标改为1到n-1</span>
    <span class="k">end</span>
    <span class="c">%正解y</span>
    <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)=</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c">%用x存储y</span>
    <span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span>
        <span class="n">y</span><span class="p">(</span><span class="nb">i</span><span class="p">)=(</span><span class="n">b</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">-</span><span class="n">d</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="c">%倒解x</span>
    <span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">)=</span><span class="n">y</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="nb">i</span><span class="p">=(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
        <span class="n">x</span><span class="p">(</span><span class="nb">i</span><span class="p">)=</span><span class="n">y</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="c">%L,U矩阵</span>
    <span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span>
        <span class="n">L</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">i</span><span class="p">)=</span><span class="n">p</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
        <span class="n">U</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">i</span><span class="p">)=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">L</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">i</span><span class="p">)=</span><span class="n">d</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
        <span class="n">U</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)=</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">end</span> <span class="c">%end of function</span></code></pre></div><p data-pid="Izk5NQrs">测试：</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%% 自写cubicSpline_2函数测试</span>
<span class="n">q</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">];</span>
<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">];</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="n">v0</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">vn</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span> <span class="n">tt</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="p">[</span><span class="n">yy</span> <span class="n">dyy</span> <span class="n">ddyy</span><span class="p">]</span> <span class="p">=</span> <span class="n">cubicSpline_2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;位置&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">yy</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="p">[</span><span class="n">v0</span><span class="p">,</span> <span class="n">vn</span><span class="p">],</span> <span class="s">&#39;o&#39;</span><span class="p">);</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">dyy</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;速度&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">ddyy</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;加速度&#39;</span><span class="p">)</span></code></pre></div><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-a277f89467afe4f606e9dcbfbbe68035_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><h2>周期三次样条：没有指定初始速度v0和最终速度vn（也就是v0和vn未知）</h2><p data-pid="w9ZbQW0L">在许多应用中，要执行的运动是周期性的，即初始位置和最终位置相同。在这种情况下，利用为计算样条曲线而指定的最后两个自由度，以使曲线具有初始和最终速度和加速度的连续性。因此，计算系数的方法与先前报告的略有不同。事实上，在这种情况下，必须考虑代替任意选择的初始和最终速度v0和vn的条件。</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-0180a04408c99ac74292f70baa88cc60_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="THF2Byf2">最后一个公式可以写成：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-c9e92c7c63cec846ee4f2f952f2545cf_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="WfWLc5ub">代入系数表达式后，从（4.8）中得到</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-32afc6e6b8048084ebb351c2e9cec70f_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="hRil3IyM">通过将该方程添加到系统（4.10）中，并考虑到在这种情况下，速度vn等于v0但未知（因此在（4.10）中，必须在左侧移动$T_{n-2}v_n$和$T_1v_0$），计算速度的线性系统变为</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-2f5ad375f9c05853f3607be942e22872_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="6O0xamrT">系统的矩阵不再是三对角的。这种情况被称为循环三对角系统，也存在有效的求解计算方法。一旦获得速度v0，…，vn?1，就可以通过（4.8）计算样条曲线的系数。</p><h3>例子</h3><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-4ff82154b68a098042d7426bb69adeb7_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><div class="highlight"><pre><code class="language-matlab"><span class="c">% 三次样条：周期三次样条，没有指定初始速度v0和终止速度vn，也就是v0和vn未知</span>
<span class="c">% Input：</span>
<span class="c">%   q：给定点的位置</span>
<span class="c">%   t：给定点位置对应的时间</span>
<span class="c">%   tt：插补周期</span>
<span class="c">% Output：</span>
<span class="c">%   yy dyy ddyy：样条曲线函数值、速度、加速度值</span>
<span class="k">function</span><span class="w"> </span>[yy dyy ddyy] <span class="p">=</span><span class="w"> </span><span class="nf">cubicSpline_3</span><span class="p">(</span>q, t, tt<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">~=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&#39;输入的数据应成对&#39;</span><span class="p">);</span>
<span class="k">end</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
<span class="n">c</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c">% 矩阵A是个(n-1)*(n-1)的循环三对角矩阵</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">Tn_1</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">T0</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tn_1</span> <span class="o">+</span> <span class="n">T0</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tn_1</span><span class="p">;</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">T0</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">Tn_1</span><span class="o">*</span><span class="n">T0</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">Tn_1</span>^<span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">+</span><span class="p">(</span><span class="n">T0</span>^<span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)));</span>
    <span class="k">else</span>
        <span class="n">Tk_1</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
        <span class="n">Tk</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">Tk</span><span class="o">*</span><span class="n">Tk_1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">+</span><span class="n">Tk_1</span>^<span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)));</span>
        <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
            <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
            <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk</span><span class="p">;</span>
        <span class="k">end</span>
    <span class="k">end</span>

<span class="k">end</span>
<span class="c">% 经过上述步骤得到矩阵A和c</span>
<span class="n">vk</span> <span class="p">=</span> <span class="n">A</span> <span class="o">\</span> <span class="n">c</span><span class="p">;</span> <span class="c">% 这一步matlab计算很慢，应换成追赶法求vk</span>
<span class="c">% 这个vk的第一个值为v0，然后v0和vn相等</span>
<span class="c">% 得到中间插补点的速度vk，然后调用cubicSpline_1即可</span>
<span class="n">v_</span> <span class="p">=</span> <span class="p">[</span><span class="n">vk</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">vk</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span>
<span class="c">% v_ = [-2.28 -2.78 2.99 5.14 2.15 -1.8281 -2.28]</span>
<span class="p">[</span><span class="n">yy</span> <span class="n">dyy</span> <span class="n">ddyy</span><span class="p">]</span> <span class="p">=</span> <span class="n">cubicSpline_1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v_</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>

<span class="k">end</span></code></pre></div><p data-pid="R995yUMC">测试：</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%% 自写cubicSpline_3函数测试</span>
<span class="n">q</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">];</span>
<span class="n">t1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">36</span><span class="p">];</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="n">tt</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="p">[</span><span class="n">yy</span> <span class="n">dyy</span> <span class="n">ddyy</span><span class="p">]</span> <span class="p">=</span> <span class="n">cubicSpline_3</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>
<span class="p">[</span><span class="n">yy_</span><span class="p">,</span> <span class="n">dyy_</span><span class="p">,</span> <span class="n">ddyy_</span><span class="p">]</span> <span class="p">=</span> <span class="n">cubicSpline_3</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;位置&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">yy</span><span class="p">);</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t1</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t1</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">yy_</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c">% plot([t(1), t(n)], [v0, vn], &#39;o&#39;);</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">dyy</span><span class="p">);</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t1</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t1</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">dyy_</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;速度&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">ddyy</span><span class="p">);</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t1</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t1</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">ddyy_</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;加速度&#39;</span><span class="p">)</span></code></pre></div><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-8d8949f6c5ba64522e8d2f13b8163bc6_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><h2>具有指定初始速度v0和最终速度vn的三次样条（v0和vn已知）：基于加速度的计算</h2><p data-pid="ebKVXwVt">定义三次样条还有一种方法：样条曲线的一般多项式qk（t）可以表示为在其端点处计算的二阶导数的函数，也就是加速度$\ddot{q}\left(t_{k}\right)=\omega_{k}{k=0,...,n}$,，而不是速度$v_k$。可以计算得到此时的多项式表达式为</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-5bf870a281afa108d7102fdbd9addadc_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="ewC_iwWS">这样的话，速度和加速度就是如下计算式</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-2226e268bab0f41793505ee1e567e80d_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="t6mPsVp0">这样的话，未知数就是加速度$\omega_k$，因为从上面的计算式可以发现，曲线的未知参数就是加速度了，因此它是唯一定义样条曲线的。由于中间点的速度和加速度的连续性，我们得到</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-43e629bb7976b708ffb7d3ca4ad30460_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="i-dYcFHo">结合式（4.15）、（4.17）和（4.18），可以得到</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-44d50ff6eb6d3356ffe473d2a983ecfd_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="Xpf1h523">其中k=1,…,n-1。另外，初始速度和最终速度有如下条件</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-c838ab23ab7bd72c9e7f3c22432f3b22_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="UR8KtyAf">由此可以推导得到</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-eb8151209ac0fe36153f68e959dcabaf_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="A4OY30_T">结合（4.19）-（4.21），可以得到如下线性系统</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-0598bc08ae967d86d7a4a1ac6519bc95_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="mFBFBBdt">其中，(n+1)阶三对角对称矩阵A（其中未知参数$\omega=[\omega_0,\omega_1,...,\omega_n]^T$）为</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-f099784784a48372044338419cd60109_720w.jpg" ><br><img src="v2-4aa537ef223fb31a1e6a590ad226ada7_720w.jpg" ><p data-pid="S6sMKG5S">同样是利用追赶法解三对角线方程组，通过将解方程得到的$\omega _k$带入（4.14）中，最终得到样条曲线。除了利用（4.14）来描述三次样条曲线之外，显然，还是可以根据初始定义来描述三次样条曲线，即</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-d3bb0c823963c0a9055032b043f5672d_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="1VKdQf_p">其中样条曲线的参数a呢就可以通过已知的点$q_k$和已经求得的加速度$\omega _k$来计算，计算式如下</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-4879fda10c31674abe29b596ff6a76c3_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="TZkgiWZL">这个方法主要是为下面的方法做准备，因此不写例子。</p><h2>具有指定初始、最终速度以及加速度的三次样条曲线</h2><p data-pid="lMfkKcFh">样条曲线是一个二阶连续导数的函数，但通常不可能同时指定初始速度和最终速度以及加速度。因此，样条曲线在其末端的特征是速度或加速度的不连续性，一般情况下我们会指定初始和最终速度，则此时初始和最终加速度难以保证连续，会出现突变。下面需要做的就是需要保证在指定初始速度和最终速度的前提下，还要保证初始、最终加速度从0开始连续变化。如果这些不连续代表一个问题，可以采用不同的方法：</p><ul><li data-pid="BtJY9UwW"> 一个5次多项式函数可以用于第一个和最后一个域，其缺点是允许在这些段中有更大的超调，并且稍微增加了计算负担；<br/> </li><li data-pid="owt3QXzH"> 在第一段和最后一段中添加两个自由额外点（从这个意义上说，这些点不能先验地固定），并通过施加所需的速度和加速度的初始值和最终值来计算它们的值。<br/> </li></ul><p data-pid="JCfL-Ybg">后一种方法现在详细说明。让我们考虑一个要插值的n-1点向量，这两个向量中都没有第二个值以及倒数第二个值，也就是q1、t1和qn-1、tn-1（目前我还不知道为啥要这么做。。。）</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-6799a945814a31311619607a53d96aeb_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="U376BzfL">对应的时间节点为</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-8a8a1b15d918b8b37d37773f028f989e_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="rSZtbzrc">以及同时考虑速度v0，vn和加速度a0，an的边界条件。为了施加所需的加速度，增加了两个额外的点$\bar{q}<i>{1}$ 和 $\bar{q}</i>{n-1}$。时间瞬间$\overline{t_{1}}$ 和 $\bar{t}_{n-1}$分别位于t0和t2之间以及tn-2和tn之间。不过可以分析得到，这种处理办法虽然能够对一条轨迹施加轨迹长度、初始速度、终止速度、初始加速度、终止加速度这五种约束条件，但是前提是额外增加两个轨迹点以及时间点，这样可能破坏时间最优规划的初衷，额外增加约束可能也会导致轨迹灵活性变差。。。</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-97b76838a3077dca3187f3cbdd8e48d5_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="WY6isrhO">增加的这两个点，可以通过已知的变量去表达这两个点，即初始/最终的位置、速度以及加速度（q0/qn,v0/vn,a0/an）同时包括在这些点上的加速度w1和wn-1（其中边界点的加速度是用a0和an来表示，而中间点的加速度是用w来表示）。这样，就可以考虑初始加速度和最终加速度的约束。</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-995fb19d41ec75cc35704d2c0cf2e6f1_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="b5KQO4ca">将（4.26）和（4.27）替换掉（4.24）中的有关项，通过重新排列n-1方程，我们得到一个线性系统</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-bcee7d74b176be50360ac44791c4f02c_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="lNXBhaha">其中</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-b881ca2d5bb1f53549673bc105c8b338_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-cbd5335e1b25388c765d7525344bd159_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="MJ2ZGI8Q">注意，T0、T1和Tn-2、Tn-1分别是$\overline{t_{1}}$ 和 $\bar{t}_{n-1}$的函数，可以在间隔（t0、t2）和（tn-2、tn）中任意选择，例如</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-8f8b7ef08920c025a0552ff1b473e554_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="M6XD1P9-">通过求解方程组（4.28）可以得到中间插补点的加速度为</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-c8ef27593ee3f5804e30e4405328e9c8_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="UmqUthQa">与边界值a0和an一起，就可以根据（4.14）或者（4.25）计算整体的样条曲线。</p><h3>例子</h3><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-5c52375ec5decb9f1e20aeb40e31abf3_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="VEgrf84e">其中v0=2，vn=-3，a0=0，an=0。额外增加的两个时间点t1=2.5，t7=16.5，当然也可以任意选择。</p><div class="highlight"><pre><code class="language-matlab"><span class="c">% 三次样条：指定初始、终止速度以及加速度，也就是v0，vn，a0，an已知</span>
<span class="c">% 这个方法需要增加两个额外的点q1_和qn-1_</span>
<span class="c">% q1_在原有q1和q2之间，qn-1_在原有的qn-1和qn之间</span>
<span class="c">% 这两个额外点对应的时间t1_和tn-1_需要计算，可以任意选择，本程序选择取平均值</span>
<span class="c">% Input：</span>
<span class="c">%   q：给定点的位置</span>
<span class="c">%   t：给定点位置对应的时间</span>
<span class="c">%   v0：初始速度</span>
<span class="c">%   vn：终止速度</span>
<span class="c">%   a0：初始加速度</span>
<span class="c">%   an：终止加速度</span>
<span class="c">%   tt：插补周期</span>
<span class="c">% Output：</span>
<span class="c">%   yy dyy ddyy：样条曲线函数值、速度、加速度值</span>
<span class="k">function</span><span class="w"> </span>[yy dyy ddyy q1 qn_1] <span class="p">=</span><span class="w"> </span><span class="nf">cubicSpline_4</span><span class="p">(</span>q, t, v0, vn, a0, an, tt<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">if</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">~=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&#39;输入的数据应成对&#39;</span><span class="p">);</span>
<span class="k">end</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">q</span><span class="p">);</span> <span class="c">% 原来的点数量</span>
<span class="c">% 增加两个额外点q1_和qn-1_，计算两点对应的时间点</span>
<span class="n">t1_</span> <span class="p">=</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">tn_1_</span> <span class="p">=</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="c">% 更新时间向量</span>
<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">t1_</span><span class="p">,</span> <span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tn_1_</span><span class="p">,</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)];</span>
<span class="c">% 更新点的数量</span>
<span class="n">n</span> <span class="p">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
<span class="c">% 矩阵A是个(n-2)阶对角占优矩阵</span>
<span class="n">A</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
<span class="n">c</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
    <span class="n">Tk_1</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">Tk</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Tk_1</span> <span class="o">+</span> <span class="n">Tk</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="n">Tk</span><span class="o">/</span><span class="n">Tk_1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">((</span><span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">Tk_1</span><span class="o">-</span><span class="n">v0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Tk</span><span class="o">/</span><span class="n">Tk_1</span><span class="p">)</span><span class="o">-</span><span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="n">Tk</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">Tk_1</span><span class="p">))</span><span class="o">*</span><span class="n">Tk</span><span class="p">);</span>
    <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">T0</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk</span> <span class="o">-</span> <span class="p">(</span><span class="n">T0</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Tk</span><span class="p">;</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">((</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">Tk_1</span><span class="o">-</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">Tk</span><span class="o">+</span><span class="n">v0</span><span class="o">*</span><span class="p">(</span><span class="n">T0</span><span class="o">/</span><span class="n">Tk</span><span class="p">)</span><span class="o">+</span><span class="n">a0</span><span class="o">*</span><span class="p">(</span><span class="n">T0</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">Tk</span><span class="p">));</span>
    <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">Tn_1</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk</span><span class="p">;</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tn_1</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">Tk_1</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">((</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="n">Tk_1</span><span class="o">-</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">4</span><span class="p">))</span><span class="o">/</span><span class="n">Tk</span><span class="o">-</span><span class="n">vn</span><span class="o">*</span><span class="p">(</span><span class="n">Tn_1</span><span class="o">/</span><span class="n">Tk_1</span><span class="p">)</span><span class="o">+</span><span class="n">an</span><span class="o">*</span><span class="p">(</span><span class="n">Tn_1</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">Tk_1</span><span class="p">));</span>
    <span class="k">elseif</span> <span class="nb">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="n">Tk_1</span><span class="o">/</span><span class="n">Tk</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">((</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">Tk</span><span class="o">+</span><span class="n">vn</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">Tk_1</span><span class="o">/</span><span class="n">Tk</span><span class="p">)</span><span class="o">-</span><span class="n">an</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="n">Tk_1</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">Tk</span><span class="p">))</span><span class="o">*</span><span class="n">Tk_1</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk</span><span class="p">;</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Tk</span> <span class="o">+</span> <span class="n">Tk_1</span><span class="p">);</span>
        <span class="n">A</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">Tk_1</span><span class="p">;</span>
        <span class="n">c</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">6</span><span class="o">*</span><span class="p">((</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">/</span><span class="n">Tk_1</span><span class="o">-</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">Tk</span><span class="p">);</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="c">% 经过上述步骤得到对角占优矩阵A和c</span>
<span class="n">wk</span> <span class="p">=</span> <span class="n">A</span> <span class="o">\</span> <span class="n">c</span><span class="p">;</span> <span class="c">% 这一步matlab计算很慢，应换成追赶法求vk</span>
<span class="c">% for i = 1: n-2</span>
<span class="c">%     a(i) = A(i, i); % 对角线</span>
<span class="c">%     if i == n-3</span>
<span class="c">%         b(i) = A(i, i+1); % 上边</span>
<span class="c">%         d(i) = A(i+1, i); % 下边</span>
<span class="c">%         continue;</span>
<span class="c">%     elseif i &lt; n-2</span>
<span class="c">%         b(i) = A(i, i+1); % 上边</span>
<span class="c">%         d(i) = A(i+1, i); % 下边</span>
<span class="c">%     end</span>
<span class="c">% end</span>
<span class="c">% [~, ~, wk_] = crout(a, b, d, c); % 追赶法</span>
<span class="n">n_</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">wk</span><span class="p">);</span>
<span class="n">q1</span> <span class="p">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">T0</span><span class="o">*</span><span class="n">v0</span> <span class="o">+</span> <span class="p">((</span><span class="n">T0</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">a0</span> <span class="o">+</span> <span class="p">((</span><span class="n">T0</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">wk</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">Tn_1</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="n">qn_1</span> <span class="p">=</span> <span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Tn_1</span><span class="o">*</span><span class="n">vn</span> <span class="o">+</span> <span class="p">((</span><span class="n">Tn_1</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">an</span> <span class="o">+</span> <span class="p">((</span><span class="n">Tn_1</span>^<span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">wk</span><span class="p">(</span><span class="n">n_</span><span class="p">);</span>
<span class="c">% 更新位置q向量</span>
<span class="n">q</span> <span class="p">=</span> <span class="p">[</span><span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">qn_1</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)];</span>
<span class="c">% 更新加速度w向量</span>
<span class="n">w</span> <span class="p">=</span> <span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">wk</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">an</span><span class="p">];</span>

<span class="c">% 规划样条轨迹</span>
<span class="n">T</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c">% 运行总时长</span>
<span class="n">nn</span> <span class="p">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">tt</span><span class="p">;</span> <span class="c">% 总点数</span>
<span class="n">yy</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>
<span class="n">dyy</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>
<span class="n">ddyy</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">);</span>
<span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">Tk</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="n">a0</span> <span class="p">=</span> <span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span>
    <span class="n">a1</span> <span class="p">=</span> <span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">/</span><span class="n">Tk</span><span class="o">-</span><span class="p">(</span><span class="n">Tk</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
    <span class="n">a2</span> <span class="p">=</span> <span class="n">w</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">a3</span> <span class="p">=</span> <span class="p">(</span><span class="n">w</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">w</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">Tk</span><span class="p">);</span>

    <span class="k">for</span> <span class="n">tk</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">):</span> <span class="n">tt</span><span class="p">:</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">tk</span> <span class="o">==</span> <span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">end</span>
        <span class="n">yy</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
        <span class="n">dyy</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">))</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">power</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">ddyy</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">tk</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
        <span class="nb">j</span> <span class="p">=</span> <span class="nb">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">end</span></code></pre></div><p data-pid="uzgt4EIT">测试：</p><div class="highlight"><pre><code class="language-matlab"><span class="c">%% 自写cubicSpline_4函数测试</span>
<span class="n">q</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">];</span>
<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">18</span><span class="p">];</span>
<span class="n">v0</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">vn</span> <span class="p">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span> <span class="n">a0</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">an</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">tt</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="p">[</span><span class="n">yy</span> <span class="n">dyy</span> <span class="n">ddyy</span> <span class="n">q1</span> <span class="n">qn_1</span><span class="p">]</span> <span class="p">=</span> <span class="n">cubicSpline_4</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">vn</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">an</span><span class="p">,</span> <span class="n">tt</span><span class="p">);</span>
<span class="c">% 增加两个额外点q1_和qn-1_，计算两点对应的时间点</span>
<span class="n">t1_</span> <span class="p">=</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">tn_1_</span> <span class="p">=</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="c">% 更新时间向量</span>
<span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">t1_</span><span class="p">,</span> <span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tn_1_</span><span class="p">,</span> <span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)];</span>
<span class="n">n</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="c">% 更新n </span>
<span class="c">% 更新q</span>
<span class="n">q</span> <span class="p">=</span> <span class="p">[</span><span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span> <span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="n">qn_1</span><span class="p">,</span> <span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)];</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;位置&#39;</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">yy</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s">&#39;r*&#39;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">q</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;r*&#39;</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c">% plot([t(1), t(n)], [v0, vn], &#39;o&#39;);</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">dyy</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;速度&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">grid</span> <span class="n">on</span>
<span class="n">hold</span> <span class="n">on</span>
<span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="n">tt</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span> <span class="n">ddyy</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;加速度&#39;</span><span class="p">)</span></code></pre></div><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-b68c9ce73e8d775ec5a1201e549d0986_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="ZiyEZHHQ">三次样条部分还有平滑三次样条，后面再写，今天就到这里~</p><h2>参考文献（实际上我就是翻译了一下下。。。）</h2><p data-pid="oD8lp9CA">Trajectory Planning for Automatic Machines and Robots</p>
<br><div id="SCURVE"><strong>基于S型曲线的连续多段曲线插补平滑过渡的规划算法</strong></div>
<p data-first-child data-pid="gxafifH9">无姿态规划，小伙伴可以自己开发</p><p data-pid="qs07rsMJ">本教程只是提供框架，工程慎用。</p><p data-pid="RQQ7cl5w">S速度规划代码<a href="https://github.com/OpenRobotSL/TrajectoryPlanning" >OpenRobotSL/TrajectoryPlanning</a>S速度规划代码</p><a href="https://github.com/OpenRobotSL/TrajectoryPlanning" >https://github.com/OpenRobotSL/TrajectoryPlanning</a><a href="https://blog.csdn.net/qq_26565435/article/details/98789361">基于S型曲线的连续多段曲线插补平滑过渡的规划算法（Matlab）_xuuyann-CSDN博客</a><h2>写在前面</h2><p data-pid="gs_d5obN">前面的博客已经写了关于空间直线与空间圆弧的常用插补算法，而这些都是单一路径，实际中并不实用。对于连续多段路径，传统方法是将多段路径细分，然后对每段路径采用首尾速度为0的加减速算法（S型曲线或梯形曲线），这就带来了频繁启停的问题，容易对机械臂造成冲击，同时运行时间较长。</p><p data-pid="moF3UExU">下面我把前面博客中提到的非对称S型加减速算法与空间中多段路径相结合，实现多段路径平滑过渡，减少运行时间。简单画一个轮廓状的“S”字符：</p><p data-pid="Sw51cMjz">本文方法：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-06050b958156333a008e5c3c97a29e1d_720w.jpg" ><br><img src="v2-8aab2bf5432e0aa8bd29effade06aec2_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="E53mxST7">速度与加速度曲线：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-ecdb094d9297e99057db6e769ea9ff46_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="_icpcROg">采用分段路径首尾速度为0的加减速控制方法：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-9eb0743e14475cd3a081924d130fc26b_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="TOoorCGf">速度与加速度曲线：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-3073c3aee72abd41b8522c160d95f307_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="aIeyhrED">对比结果还是很明显滴~本文的方法运行时间更短了，没有频繁启停，轮廓曲线更圆滑。如果在加上动力学方面的约束，就更好了。这个以后再讨论。</p><h2>预处理</h2><p data-pid="5OEjAz58">“预处理”，顾名思义就是拿到了一个轮廓轨迹，先想想这个轨迹如何分段，分段后如何衔接。</p><p data-pid="L9JFgDXH">一般工业机器人任务空间的运动轨迹都是由圆弧段和直线段组成的，对于多段连续直线路径而言，任意两段相连直线段的连接处需要平滑处理，这里选择建立圆弧模型进行路径拐角过渡。下面给出圆弧模型的建立过程：</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-cb9255c7aa6c64efcf1ab00c103cf527_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-3302213986a7d0814a365a6d2cd5abd4_720w.jpg" ><br><img src="v2-85c4b1b59d89d155041853da33b32c54_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-cda2667038b549cb9c151ff2f4e10e13_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="SL76MZsJ">Matlab函数如下：</p><div class="highlight"><pre><code class="language-matlab"><span class="c">% 拾取放置操作分段路径转接模型</span>
<span class="c">% 参数： 用户设定的三个拾放路径点P0,P1,P2的位置</span>
<span class="c">%       过渡半径r</span>
<span class="c">%       最大加速度Amax</span>
<span class="c">%       插补周期t</span>
<span class="c">% 返回值： 转接点Pt1，Pt2，分割后的小路径长度d1,d2,圆心C，圆心角theta</span>
<span class="c">%         </span>
<span class="k">function</span><span class="w"> </span>[Pt1, Pt2, d1, d2, C, theta] <span class="p">=</span><span class="w"> </span><span class="nf">PathSegmentTrans</span><span class="p">(</span>P0, P1, P2, r, t<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="c">% 求拐角theta</span>
<span class="n">P1P0</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">P0</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">P0</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">P0</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">P1P2</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">P2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">P2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">P2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">vec_P1P0</span> <span class="p">=</span> <span class="p">[</span><span class="n">P0</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">P0</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">P0</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">3</span><span class="p">)];</span>
<span class="n">vec_P1P2</span> <span class="p">=</span> <span class="p">[</span><span class="n">P2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">P2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">P2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">3</span><span class="p">)];</span>
<span class="n">theta</span> <span class="p">=</span> <span class="nb">acos</span><span class="p">((</span><span class="nb">dot</span><span class="p">(</span><span class="n">vec_P1P0</span><span class="p">,</span> <span class="n">vec_P1P2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">P1P0</span><span class="o">*</span><span class="n">P1P2</span><span class="p">));</span>
<span class="c">% 求转接点Pt1、Pt2</span>
<span class="n">vec_P1Pt1</span> <span class="p">=</span> <span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="nb">tan</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">P1P0</span><span class="p">)</span> <span class="o">*</span> <span class="n">vec_P1P0</span><span class="p">;</span>
<span class="n">vec_P1Pt2</span> <span class="p">=</span> <span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="nb">tan</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">P1P2</span><span class="p">)</span> <span class="o">*</span> <span class="n">vec_P1P2</span><span class="p">;</span>
<span class="n">Pt1</span> <span class="p">=</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">vec_P1Pt1</span><span class="p">;</span>
<span class="n">Pt2</span> <span class="p">=</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">vec_P1Pt2</span><span class="p">;</span>
<span class="c">% 求路径长度d1、弧长d2</span>
<span class="n">d1</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">Pt1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">Pt1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P0</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">Pt1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">P0</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">d2</span> <span class="p">=</span> <span class="p">(</span><span class="nb">pi</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">;</span>
<span class="c">% % 求转接速度vt</span>
<span class="c">% 这是考虑机械系统动力学匀速因素得到的转接速度</span>
<span class="c">% a = sqrt(Amax * r);</span>
<span class="c">% b = d2 / t;</span>
<span class="c">% if (a &gt; b)</span>
<span class="c">%     vt  = b;</span>
<span class="c">% else</span>
<span class="c">%     vt = a;</span>
<span class="c">% end</span>
<span class="c">% 求圆心C</span>
<span class="n">vec_Pt1M</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pt2</span> <span class="o">-</span> <span class="n">Pt1</span><span class="p">);</span>
<span class="n">M</span> <span class="p">=</span> <span class="n">Pt1</span> <span class="o">+</span> <span class="n">vec_Pt1M</span><span class="p">;</span>
<span class="n">vec_P1M</span> <span class="p">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">P1</span><span class="p">;</span>
<span class="n">P1M</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">M</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">P1</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">P1C</span> <span class="p">=</span> <span class="n">r</span> <span class="o">/</span> <span class="nb">sin</span><span class="p">(</span><span class="n">theta</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<span class="n">vec_P1C</span> <span class="p">=</span> <span class="p">(</span><span class="n">P1C</span> <span class="o">/</span> <span class="n">P1M</span><span class="p">)</span> <span class="o">*</span> <span class="n">vec_P1M</span><span class="p">;</span>
<span class="n">C</span> <span class="p">=</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">vec_P1C</span><span class="p">;</span>
<span class="k">end</span></code></pre></div><h2>基于非对称S曲线的轨迹规划</h2><p data-pid="F4EumCjy">核心方法：<a href="https://blog.csdn.net/qq_26565435/article/details/94657852" class=" wrap external" target="_blank" rel="nofollow noreferrer">机器人学回炉重造（6）：关节空间规划方法——梯形加减速（与抛物线拟合的线性函数）、S型曲线规划</a></p><p data-pid="CaHQJQ2s">一些文献中给S型曲线加了很多修饰词，比如非对称、带约束啥的，其实就是我上面那篇博客的S曲线，首尾速度可以不一样，带有位移、速度以及加速度约束。</p><br><img src="v2-b69dea06b5a7eaa15a55304a2cb141b3_720w.jpg" ><br><img src="v2-42d2f00daa54367a01885bf758a71904_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-43b790e019a95865c14fe82275c09a49_720w.jpg" ><div class="highlight"><pre><code class="language-matlab"><span class="c">% 获取转接运动参数（速度）</span>
<span class="c">% 参数： 分段路径长度d1,d2,d3</span>
<span class="c">%       P0、P1、P2的速度v0, v1, v2（P1为中间点）</span>
<span class="c">%       最大加速度amax,最大加加速度jmax</span>
<span class="c">% 返回值： 转接点速度vt（即为路径上能够达到的最大速度）</span>
<span class="k">function</span><span class="w"> </span>[vt] <span class="p">=</span><span class="w"> </span><span class="nf">TransMotionPara</span><span class="p">(</span>d1, d2, d3, v0, v1, v2, amax, jmax<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="c">% 得到规划参数Ta, Tv, Td, Tj1, Tj2, q0, q1, v0, v1, vlim, amax, amin, alima, alimd, jmax, jmin</span>
<span class="n">q0</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">q1</span> <span class="p">=</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span> <span class="o">+</span> <span class="n">d3</span>
<span class="n">para</span> <span class="p">=</span> <span class="n">STrajectoryPara</span><span class="p">(</span><span class="n">q0</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">amax</span><span class="p">,</span> <span class="n">jmax</span><span class="p">);</span>
<span class="n">vt</span> <span class="p">=</span> <span class="n">para</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="k">end</span></code></pre></div><h2>插补</h2><p data-pid="OrSN9iPv">这里先只讲位置插补</p><p data-pid="EZpi2Ha3">预处理过后，轨迹就分段成为了一大堆直线段和一大堆圆弧段，这里要做的就是对这些空间直线和空间圆弧进行插补，于是又回到老话题了……</p><p data-pid="Zjh8App5">这里直线段插补不多说，和前面博客中提到的一样，空间单一直线位置插补+ S型加减速曲线归一化处理，具体方法见<a href="https://blog.csdn.net/qq_26565435/article/details/98384114" class=" wrap external" target="_blank" rel="nofollow noreferrer">基于带约束S型加减速曲线的空间直线插补与空间圆弧插补算法（Matlab）</a></p><p data-pid="pjGUzBdu">圆弧段插补也大同小异，方法有所不同，但基本是采用局部坐标系的空间圆弧插补方法和齐次坐标变换原理。新建立的局部坐标系UVW如下图所示，下面图中点的下标和我上面写的有些不一样，忽略所有$P_{bi}$并将$P_{ei}$看成$P_{Ti}$就行了，我就没有重新画图了。以第一段轨迹为例，新坐标系建立过程如下：</p><br><img src="v2-efe21460df0b0ef7e9abc0dedcdf8651_720w.jpg" ><p data-pid="Tlzs4dl5">然后就是老生常谈的话题，把局部新坐标系中的圆弧通过左乘该坐标系相对基座标系的齐次变换矩阵从而变换回原来的XYZ值。</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-87a859068369217ac90ccf3edae1a164_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="5Pq5eUYO">Matlab函数如下，我在函数中留了姿态插补四元数参数的位置，留着以后加姿态插补用：</p><div class="highlight"><pre><code class="language-matlab"><span class="c">% 过渡圆弧的插补算法，搭配ContinueSpaceLine使用</span>
<span class="c">% 参数： Pt1,Pt2,P1(Pt1和Pt2的中间点),Qt1,Qt2</span>
<span class="c">%       过渡圆弧弧长d、过渡半径r、插补周期t</span>
<span class="c">%       圆弧插补速度vt</span>
<span class="c">% 返回值： 插补点数N，插补时间Tt</span>
<span class="k">function</span><span class="w"> </span>[x y z qk N Tt] <span class="p">=</span><span class="w"> </span><span class="nf">Transition_arc</span><span class="p">(</span>Pt1, Pt2, P1, Qt1, Qt2, d, r, t, vt<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="c">% 建立新坐标系UVW</span>
<span class="c">% 新坐标轴V</span>
<span class="n">vec_Pt1P1</span> <span class="p">=</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">Pt1</span><span class="p">;</span>
<span class="n">Pt1P1</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">P1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Pt1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">P1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Pt1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">P1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">Pt1</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">V</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">Pt1P1</span><span class="p">)</span> <span class="o">*</span> <span class="n">vec_Pt1P1</span><span class="p">;</span>
<span class="n">ox</span> <span class="p">=</span> <span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">oy</span> <span class="p">=</span> <span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">oz</span> <span class="p">=</span> <span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="c">% 新坐标系W</span>
<span class="n">vec_Pt2P1</span> <span class="p">=</span> <span class="n">P1</span> <span class="o">-</span> <span class="n">Pt2</span><span class="p">;</span>
<span class="n">vec_W_</span> <span class="p">=</span> <span class="nb">cross</span><span class="p">(</span><span class="n">vec_Pt1P1</span><span class="p">,</span> <span class="n">vec_Pt2P1</span><span class="p">);</span>
<span class="n">W_</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">vec_W_</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">vec_W_</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">power</span><span class="p">(</span><span class="n">vec_W_</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">W</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">W_</span><span class="p">)</span> <span class="o">*</span> <span class="n">vec_W_</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">W</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">ay</span> <span class="p">=</span> <span class="n">W</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">az</span> <span class="p">=</span> <span class="n">W</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="c">% 新坐标系U</span>
<span class="n">U</span> <span class="p">=</span> <span class="nb">cross</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">);</span>
<span class="n">nx</span> <span class="p">=</span> <span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">ny</span> <span class="p">=</span> <span class="n">U</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">nz</span> <span class="p">=</span> <span class="n">U</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="c">% 相对于基座标系{O-XYZ}， 新坐标系{C-UVW}的坐标变换矩阵</span>
<span class="n">T</span> <span class="p">=</span> <span class="p">[</span><span class="n">nx</span> <span class="n">ox</span> <span class="n">ax</span> <span class="n">Pt1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
     <span class="n">ny</span> <span class="n">oy</span> <span class="n">ay</span> <span class="n">Pt1</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
     <span class="n">nz</span> <span class="n">oz</span> <span class="n">az</span> <span class="n">Pt1</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
      <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">1</span><span class="p">];</span>

<span class="c">% 计算两个四元数之间的夹角</span>
<span class="n">dot_q</span> <span class="p">=</span> <span class="n">Qt1</span><span class="p">.</span><span class="n">s</span><span class="o">*</span><span class="n">Qt2</span><span class="p">.</span><span class="n">s</span> <span class="o">+</span> <span class="n">Qt1</span><span class="p">.</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Qt2</span><span class="p">.</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Qt1</span><span class="p">.</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Qt2</span><span class="p">.</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">Qt1</span><span class="p">.</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">Qt2</span><span class="p">.</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">dot_q</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dot_q</span> <span class="p">=</span> <span class="o">-</span><span class="n">dot_q</span><span class="p">;</span>
<span class="k">end</span>
<span class="c">% 插补时长</span>
<span class="n">Tt</span> <span class="p">=</span> <span class="n">d</span> <span class="o">/</span> <span class="n">vt</span><span class="p">;</span>
<span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">t</span><span class="p">:</span> <span class="n">Tt</span>
    <span class="c">% 位置插补</span>
    <span class="n">x_</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">r</span> <span class="o">-</span>  <span class="n">r</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">vt</span><span class="o">*</span><span class="nb">j</span><span class="o">/</span><span class="n">r</span><span class="p">);</span>
    <span class="n">y_</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">r</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">vt</span><span class="o">*</span><span class="nb">j</span><span class="o">/</span><span class="n">r</span><span class="p">);</span>
    <span class="n">P</span> <span class="p">=</span> <span class="n">T</span><span class="o">*</span><span class="p">[</span><span class="n">x_</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span> <span class="n">y_</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">x</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">y</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">z</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">P</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="c">% 单位四元数球面线性姿态插补</span>
    <span class="c">% 插值点四元数</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dot_q</span> <span class="o">&gt;</span> <span class="mf">0.9995</span><span class="p">)</span>
        <span class="n">k0</span> <span class="p">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">;</span>
        <span class="n">k1</span> <span class="p">=</span> <span class="n">t</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">sin_t</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">power</span><span class="p">(</span><span class="n">dot_q</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
        <span class="n">omega</span> <span class="p">=</span> <span class="nb">atan2</span><span class="p">(</span><span class="n">sin_t</span><span class="p">,</span> <span class="n">dot_q</span><span class="p">);</span>
        <span class="n">k0</span> <span class="p">=</span> <span class="nb">sin</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">omega</span><span class="p">))</span> <span class="o">/</span> <span class="nb">sin</span><span class="p">(</span><span class="n">omega</span><span class="p">);</span>
        <span class="n">k1</span> <span class="p">=</span> <span class="nb">sin</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sin</span><span class="p">(</span><span class="n">omega</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">qk</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">Qt1</span> <span class="o">*</span> <span class="n">k0</span> <span class="o">+</span> <span class="n">Qt2</span> <span class="o">*</span> <span class="n">k1</span><span class="p">;</span>
    <span class="n">N</span> <span class="p">=</span> <span class="nb">i</span><span class="p">;</span>
    <span class="nb">i</span> <span class="p">=</span> <span class="nb">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">end</span>

<span class="k">end</span></code></pre></div><h2>字符轮廓提取</h2><p data-pid="EL3B_Nse">CAD中画50mm*50mm的栅格图，在栅格图内绘制字体轮廓，然后提取关键点坐标。</p><p data-pid="RhH4uwYL">以栅格左下角的点作为坐标原点，以水平方向为X轴，以垂直方向为Y轴建立平面直角坐标系，字符“S”的关键点坐标如图所示</p><p class="ztext-empty-paragraph"><br/></p><br><img src="v2-e5716f882ead428cdb9e5acc257fa753_720w.jpg" ><p class="ztext-empty-paragraph"><br/></p><p data-pid="gl-zv-Au">提取坐标原点O的坐标值，然后用其他关键点的坐标值减去原点的，就能得到这些关键点在当前栅格坐标系下的坐标值，如下表</p><p data-pid="60ZC9Pkc">| 关键点 |  A   |  B   |  C   |  D   |  E   |  F   |  G   |  H   |  I   |  J   |  K   |  L   | | :----: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | |   X    |  5   |  45  |  45  |  12  |  12  |  46  |  46  |  5   |  5   |  38  |  38  |  5   | |   Y    |  0   |  0   |  22  |  28  |  39  |  39  |  45  |  46  |  22  |  16  |  7   |  7   |</p><p data-pid="CDhSnAUO">ok完事儿~</p><h2>拼起来</h2><p data-pid="s7WCk7ku">是的，最后总的程序就是把上面分段规划得到的一堆直线插补点和一堆圆弧插补点，按照时间顺序拼起来。总程序我就不放了，仁者见仁智者见智。</p>
</p>
<p>
<br> ======================================================================
<br><strong> 我的测试结果及程序  </strong>
<br>下面是我测试的代码：
<pre>

 
</pre>
<br> <img src="myTestResult.png"   width="868px" height="478px">


</p>



                            </div>
                        </article>
                    </div>
                </div>
            </div>
          <footer id="colophon" role="contentinfo">
	<div id="site-generator">孙悟空 from 吉林大学自动化 @ sunwukong@sangkeji.com</div>
	<script src="../../../footer.js"></script>
          </footer>
        </div>
    </body>
</html>
