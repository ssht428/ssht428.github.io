<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>MATLAB金融工具箱：05：用于统计套利的机器学习1：数据管理和可视化</title>
        <link rel="stylesheet" type="text/css" media="all" href="../../../style.css">
    </head>
    <body class="post-template-default single single-post postid-14 single-format-standard logged-in admin-bar single-author singular two-column left-sidebar customize-support">
        <div id="page" class="hfeed">
            <div id="main">
                <div id="primary">
                    <div id="content" role="main">        
                        <article id="post-14" class="post-14 post type-post status-publish format-standard hentry category-18">
                            <header class="entry-header">
                                <h1 class="entry-title">MATLAB金融工具箱：05：用于统计套利的机器学习1：数据管理和可视化</h1>
                            </header>
                            <div class="entry-content">
<br><a href="../../../index.html"> Home </a> 
<br>
<br>
<p>
<p data-first-child data-pid="7Gy3ab2k">本示例显示了在MATLAB中管理，处理和可视化大量财务数据的技术。它是有关用于统计套利的机器学习的一系列相关示例的一部分。</p><h3><b>处理大数据</b></h3><p data-pid="mZh47M6O">诸如纳斯达克这样的电子交易金融市场，会在毫秒级的时间执行订单，产生了大量的数据。可以挖掘数据流以获得统计套利机会，但是处理和存储动态分析信息的传统方法可能会被大数据淹没。幸运的是，出现了新的计算方法，MATLAB有一系列用于实现它们的工具。</p><p data-pid="MHVye_5S">计算机内存提供高速访问但容量有限，而外部存储提供低速访问但容量可能无限。计算在内存中进行；计算机从外部存储中调出数据和结果。</p><h3><b>数据文件</b></h3><p data-pid="65hmSt-M">本示例使用由LOBSTER [<a href="https://www.mathworks.com/help/finance/machine-learning-for-statistical-arbitrage-data-management-and-visualization.html%23mw_fe65ecc5-e956-416f-812f-edc0b5669e61" class=" wrap external" target="_blank" rel="nofollow noreferrer">1]</a>提供的样本数据中，包含了INTC的纳斯达克一个交易日的交易数据[<a href="https://www.mathworks.com/help/finance/machine-learning-for-statistical-arbitrage-data-management-and-visualization.html%23mw_6144443f-d02b-46b8-b632-ec653ae6aca5" class=" wrap external" target="_blank" rel="nofollow noreferrer">2]</a>，数据文件打包在Financial Toolbox?的<code>LOBSTER_SampleFile_INTC_2012-06-21_5.zip</code>中。将zip文件的内容提取到当前文件夹中。扩展的文件（包括两个CSV数据文件和文本文件<code>LOBSTER_SampleFiles_ReadMe.txt</code>占用93.7 MB的内存。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">unzip</span><span class="p">(</span>&#34;<span class="n">LOBSTER_SampleFile_INTC_2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">21</span><span class="n">_5</span><span class="p">.</span><span class="n">zip</span>&#34;<span class="p">);</span></code></pre></div><p data-pid="qZK0TFSv">数据描述了<i>限价订单簿</i>（LOB）的盘中演变，它是<i>市场订单</i>（最佳价格），<i>限价订单</i>（指定价格）以及由此产生的买卖记录。数据包括这些事件的准确时间，并跟踪从到达到取消或执行的订单。在交易日的每个时刻，LOB买卖双方的订单均处于不同<i>水平，</i>远离最低要价（卖出订单）和最高出价（买入订单）之间的中间价格。</p><p data-pid="CEJMr_s0">第5级数据（两边距离中间价格有5级）包含在2个CSV文件。从消息文件名中提取交易日期。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">MSGFileName</span> <span class="p">=</span> &#34;<span class="n">INTC_2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">21</span><span class="n">_34200000_57600000_message_5</span><span class="p">.</span><span class="n">csv</span>&#34;<span class="p">;</span>   <span class="c">% Message file (description of data)</span>
 <span class="n">LOBFileName</span> <span class="p">=</span> &#34;<span class="n">INTC_2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">21</span><span class="n">_34200000_57600000_orderbook_5</span><span class="p">.</span><span class="n">csv</span>&#34;<span class="p">;</span> <span class="c">% Data file</span>
 ?
 <span class="p">[</span><span class="n">ticker</span><span class="p">,</span><span class="nb">rem</span><span class="p">]</span> <span class="p">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">MSGFileName</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">);</span>
 <span class="n">date</span> <span class="p">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">rem</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">);</span> </code></pre></div><h3><b>数据存储</b></h3><p data-pid="xYcjzrJI">每日数据流会聚累积，需要存储空间。<i>数据仓库</i>是对于那些太大，不适合放在内存中的数据的集合库。</p><p data-pid="4T1NW7Z9">使用<code>tabularTextDatastore</code>创建消息和数据文件的数据仓库。由于文件包含不同格式的数据，因此请分别创建数据仓库。通过将<code>&#39;ReadVariableNames&#39;</code>名称-值对参数设置为<code>false</code>来忽略通用列标题（例如，<code>VarName1</code>）。将标题替换为从<code>LOBSTER_SampleFiles_ReadMe.txt</code>获得的描述性变量名称。将<code>&#39;ReadSize&#39;</code>名称-值对参数设置为<code>&#39;file&#39;</code>以允许在每个交易日结束时将格式类似的文件附加到现有数据仓库中。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">DSMSG</span> <span class="p">=</span> <span class="n">tabularTextDatastore</span><span class="p">(</span><span class="n">MSGFileName</span><span class="p">,</span><span class="s">&#39;ReadVariableNames&#39;</span><span class="p">,</span><span class="n">false</span><span class="p">,</span><span class="s">&#39;ReadSize&#39;</span><span class="p">,</span><span class="s">&#39;file&#39;</span><span class="p">);</span>
 <span class="n">DSMSG</span><span class="p">.</span><span class="n">VariableNames</span> <span class="p">=</span> <span class="p">[</span>&#34;<span class="n">Time</span>&#34;<span class="p">,</span>&#34;<span class="n">Type</span>&#34;<span class="p">,</span>&#34;<span class="n">OrderID</span>&#34;<span class="p">,</span>&#34;<span class="n">Size</span>&#34;<span class="p">,</span>&#34;<span class="n">Price</span>&#34;<span class="p">,</span>&#34;<span class="n">Direction</span>&#34;<span class="p">];</span>
 ?
 <span class="n">DSLOB</span> <span class="p">=</span> <span class="n">tabularTextDatastore</span><span class="p">(</span><span class="n">LOBFileName</span><span class="p">,</span><span class="s">&#39;ReadVariableNames&#39;</span><span class="p">,</span><span class="n">false</span><span class="p">,</span><span class="s">&#39;ReadSize&#39;</span><span class="p">,</span><span class="s">&#39;file&#39;</span><span class="p">);</span>
 <span class="n">DSLOB</span><span class="p">.</span><span class="n">VariableNames</span> <span class="p">=</span> <span class="p">[</span>&#34;<span class="n">AskPrice1</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize1</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice1</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize1</span>&#34;<span class="p">,</span><span class="c">...</span>
                        &#34;<span class="n">AskPrice2</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize2</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice2</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize2</span>&#34;<span class="p">,</span><span class="c">...</span>
                        &#34;<span class="n">AskPrice3</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize3</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice3</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize3</span>&#34;<span class="p">,</span><span class="c">...</span>
                        &#34;<span class="n">AskPrice4</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize4</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice4</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize4</span>&#34;<span class="p">,</span><span class="c">...</span>
                        &#34;<span class="n">AskPrice5</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize5</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice5</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize5</span>&#34;<span class="p">];</span></code></pre></div><p data-pid="gB0-88iV">通过选择<code>Time</code>和3级数据来创建组合的数据仓库。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">TimeVariable</span> <span class="p">=</span> &#34;<span class="n">Time</span>&#34;<span class="p">;</span>
 <span class="n">DSMSG</span><span class="p">.</span><span class="n">SelectedVariableNames</span> <span class="p">=</span> <span class="n">TimeVariable</span><span class="p">;</span>
 ?
 <span class="n">LOB3Variables</span> <span class="p">=</span> <span class="p">[</span>&#34;<span class="n">AskPrice1</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize1</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice1</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize1</span>&#34;<span class="p">,</span><span class="c">...</span>
                  &#34;<span class="n">AskPrice2</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize2</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice2</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize2</span>&#34;<span class="p">,</span><span class="c">...</span>
                  &#34;<span class="n">AskPrice3</span>&#34;<span class="p">,</span>&#34;<span class="n">AskSize3</span>&#34;<span class="p">,</span>&#34;<span class="n">BidPrice3</span>&#34;<span class="p">,</span>&#34;<span class="n">BidSize3</span>&#34;<span class="p">];</span>
 <span class="n">DSLOB</span><span class="p">.</span><span class="n">SelectedVariableNames</span> <span class="p">=</span> <span class="n">LOB3Variables</span><span class="p">;</span>
                                
 <span class="n">DS</span> <span class="p">=</span> <span class="n">combine</span><span class="p">(</span><span class="n">DSMSG</span><span class="p">,</span><span class="n">DSLOB</span><span class="p">);</span>         </code></pre></div><p data-pid="HQN7eOQB">您可以预览组合数据仓库的前几行，而无需将数据加载到内存中。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">DSPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">(</span><span class="n">DS</span><span class="p">);</span>
 <span class="n">LOBPreview</span> <span class="p">=</span> <span class="n">DSPreview</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
 <span class="n">LOBPreview</span><span class="p">=</span><span class="mi">8</span>×<span class="mi">5</span> <span class="n">table</span>
     <span class="n">Time</span>     <span class="n">AskPrice1</span>    <span class="n">AskSize1</span>    <span class="n">BidPrice1</span>    <span class="n">BidSize1</span>
     <span class="n">_____</span>    <span class="n">_________</span>    <span class="n">________</span>    <span class="n">_________</span>    <span class="n">________</span>
 ?
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>       <span class="mi">66</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   </code></pre></div><p data-pid="5rTnR_7a">预览显示了要价和出价，这表示最接近中间价格的1级数据。时间单位是午夜后的秒数，价格单位是美元金额乘以10,000，单位是股票数量（请参阅参考资料<code>LOBSTER_SampleFiles_ReadMe.txt</code>）。</p><h3><b>Tall数组和时间表</b></h3><p data-pid="5UEGQiV1">Tall数组使用MapReduce技术处理由数据仓库支持的会导致内存不足的数据。使用MapReduce时，除非执行使用该数据的特定计算，否则Tall数组将保持未计算状态。</p><p data-pid="u3TsPDIK">为MapReduce设置执行环境设置为本地MATLAB会话，而不是通过调用<code>mapreducer(0)</code>使用Parallel Computing Toolbox? 。然后，从数据仓库<code>DS</code>中用<code>tall</code>创建一个Tall数组。在Tall数组中预览数据。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">mapreducer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
 <span class="n">DT</span> <span class="p">=</span> <span class="n">tall</span><span class="p">(</span><span class="n">DS</span><span class="p">);</span>
 ?
 <span class="n">DTPreview</span> <span class="p">=</span> <span class="n">DT</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
 <span class="n">DTPreview</span> <span class="p">=</span>
 ?
   <span class="n">M</span>×<span class="mi">5</span> <span class="n">tall</span> <span class="n">table</span>
 ?
     <span class="n">Time</span>     <span class="n">AskPrice1</span>    <span class="n">AskSize1</span>    <span class="n">BidPrice1</span>    <span class="n">BidSize1</span>
     <span class="n">_____</span>    <span class="n">_________</span>    <span class="n">________</span>    <span class="n">_________</span>    <span class="n">________</span>
 ?
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>       <span class="mi">66</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
       <span class="p">:</span>          <span class="p">:</span>           <span class="p">:</span>            <span class="p">:</span>           <span class="p">:</span>
       <span class="p">:</span>          <span class="p">:</span>           <span class="p">:</span>            <span class="p">:</span>           <span class="p">:</span></code></pre></div><p data-pid="iGGQhkME">时间表允许您执行特定于时间序列的操作。由于LOB数据由并发时间序列组成，因此请转换<code>DT</code>为Tall时间表。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">DT</span><span class="p">.</span><span class="n">Time</span> <span class="p">=</span> <span class="n">seconds</span><span class="p">(</span><span class="n">DT</span><span class="p">.</span><span class="n">Time</span><span class="p">);</span> <span class="c">% Cast time as a duration from midnight.</span>
 <span class="n">DTT</span> <span class="p">=</span> <span class="n">table2timetable</span><span class="p">(</span><span class="n">DT</span><span class="p">);</span>
 ?
 <span class="n">DTTPreview</span> <span class="p">=</span> <span class="n">DTT</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
 <span class="n">DTTPreview</span> <span class="p">=</span>
 ?
   <span class="n">M</span>×<span class="mi">4</span> <span class="n">tall</span> <span class="n">timetable</span>
 ?
       <span class="n">Time</span>       <span class="n">AskPrice1</span>    <span class="n">AskSize1</span>    <span class="n">BidPrice1</span>    <span class="n">BidSize1</span>
     <span class="n">_________</span>    <span class="n">_________</span>    <span class="n">________</span>    <span class="n">_________</span>    <span class="n">________</span>
 ?
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>       <span class="mi">66</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">400</span>   
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
     <span class="mi">34200</span> <span class="nb">sec</span>    <span class="mf">2.752e+05</span>      <span class="mi">166</span>       <span class="mf">2.751e+05</span>      <span class="mi">300</span>   
         <span class="p">:</span>            <span class="p">:</span>           <span class="p">:</span>            <span class="p">:</span>           <span class="p">:</span>
         <span class="p">:</span>            <span class="p">:</span>           <span class="p">:</span>            <span class="p">:</span>           <span class="p">:</span></code></pre></div><p data-pid="wjS2A6dX">在MATLAB工作区中显示所有变量。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">whos</span>
   <span class="n">Name</span>               <span class="n">Size</span>            <span class="n">Bytes</span>  <span class="n">Class</span>                                       <span class="n">Attributes</span>
 ?
   <span class="n">DS</span>                 <span class="mi">1</span><span class="n">x1</span>                 <span class="mi">8</span>  <span class="n">matlab</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">datastore</span><span class="p">.</span><span class="n">CombinedDatastore</span>                 
   <span class="n">DSLOB</span>              <span class="mi">1</span><span class="n">x1</span>                 <span class="mi">8</span>  <span class="n">matlab</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">datastore</span><span class="p">.</span><span class="n">TabularTextDatastore</span>              
   <span class="n">DSMSG</span>              <span class="mi">1</span><span class="n">x1</span>                 <span class="mi">8</span>  <span class="n">matlab</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">datastore</span><span class="p">.</span><span class="n">TabularTextDatastore</span>              
   <span class="n">DSPreview</span>          <span class="mi">8</span><span class="n">x13</span>             <span class="mi">4516</span>  <span class="n">table</span>                                                 
   <span class="n">DT</span>                 <span class="n">Mx13</span>             <span class="mi">4718</span>  <span class="n">tall</span>                                                  
   <span class="n">DTPreview</span>          <span class="n">Mx5</span>              <span class="mi">2608</span>  <span class="n">tall</span>                                                  
   <span class="n">DTT</span>                <span class="n">Mx12</span>             <span class="mi">4512</span>  <span class="n">tall</span>                                                  
   <span class="n">DTTPreview</span>         <span class="n">Mx4</span>              <span class="mi">2416</span>  <span class="n">tall</span>                                                  
   <span class="n">LOB3Variables</span>      <span class="mi">1</span><span class="n">x12</span>              <span class="mi">936</span>  <span class="n">string</span>                                                
   <span class="n">LOBFileName</span>        <span class="mi">1</span><span class="n">x1</span>               <span class="mi">246</span>  <span class="n">string</span>                                                
   <span class="n">LOBPreview</span>         <span class="mi">8</span><span class="n">x5</span>              <span class="mi">2204</span>  <span class="n">table</span>                                                 
   <span class="n">MSGFileName</span>        <span class="mi">1</span><span class="n">x1</span>               <span class="mi">230</span>  <span class="n">string</span>                                                
   <span class="n">TimeVariable</span>       <span class="mi">1</span><span class="n">x1</span>               <span class="mi">150</span>  <span class="n">string</span>                                                
   <span class="n">date</span>               <span class="mi">1</span><span class="n">x1</span>               <span class="mi">166</span>  <span class="n">string</span>                                                
   <span class="nb">rem</span>                <span class="mi">1</span><span class="n">x1</span>               <span class="mi">230</span>  <span class="n">string</span>                                                
   <span class="n">ticker</span>             <span class="mi">1</span><span class="n">x1</span>               <span class="mi">150</span>  <span class="n">string</span>                                                </code></pre></div><p data-pid="JaZho0aA">因为所有数据都在数据存仓库中，所以工作空间使用很少的内存。</p><h3><b>预处理和计算数据</b></h3><p data-pid="GfMDMv2S">在计算评估之前，Tall数组允许对计算进行预处理或<i>排队</i>，从而改善了工作空间中的内存管理。</p><p data-pid="IJ1a7goU">中间价格<code>S</code>和失衡指数<code>I</code>用于建模LOB的动态。要对它们的计算进行排队，根据<code>DTT</code>定义计算和时间基点。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">timeBase</span> <span class="p">=</span> <span class="n">DTT</span><span class="p">.</span><span class="n">Time</span><span class="p">;</span>
 <span class="n">MidPrice</span> <span class="p">=</span> <span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidPrice1</span> <span class="o">+</span> <span class="n">DTT</span><span class="p">.</span><span class="n">AskPrice1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
 ?
 <span class="c">% LOB level 3 imbalance index:</span>
 ?
 <span class="n">lambda</span>  <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c">% Hyperparameter</span>
 <span class="n">weights</span> <span class="p">=</span> <span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">lambda</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">]);</span>
 <span class="n">VAsk</span> <span class="p">=</span> <span class="n">weights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span><span class="p">.</span><span class="n">AskSize1</span> <span class="o">+</span> <span class="n">weights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span><span class="p">.</span><span class="n">AskSize2</span> <span class="o">+</span> <span class="n">weights</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span><span class="p">.</span><span class="n">AskSize3</span><span class="p">;</span>
 <span class="n">VBid</span> <span class="p">=</span> <span class="n">weights</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidSize1</span> <span class="o">+</span> <span class="n">weights</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidSize2</span> <span class="o">+</span> <span class="n">weights</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidSize3</span><span class="p">;</span>
 <span class="n">ImbalanceIndex</span> <span class="p">=</span> <span class="p">(</span><span class="n">VBid</span><span class="o">-</span><span class="n">VAsk</span><span class="p">)</span><span class="o">./</span><span class="p">(</span><span class="n">VBid</span><span class="o">+</span><span class="n">VAsk</span><span class="p">);</span></code></pre></div><p data-pid="iS-_xnOI">不平衡指数是中间价格两侧的要价和买价的加权平均值[<a href="https://www.mathworks.com/help/finance/machine-learning-for-statistical-arbitrage-data-management-and-visualization.html%23mw_99c640b6-9f52-45ed-bb44-ba029cfad8e4" class=" wrap external" target="_blank" rel="nofollow noreferrer">3]</a>。不平衡指数是未来价格走势的潜在指标。变量<code>lambda</code>是一个<i>超参数</i>，它是训练之前指定的参数，而不是由机器学习算法估算的。超参数可能会影响模型的性能。<i>特征工程</i>是选择要在机器学习算法中使用的特定领域超参数的过程。您可以调整超参数以优化交易策略。</p><p data-pid="G1B317aP">要将预处理的表达式带入内存并对其求值，请使用<code><a href="https://www.mathworks.com/help/matlab/ref/tall.gather.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">gather</a></code>函数。此过程称为<i>延迟评估</i>。</p><div class="highlight"><pre><code class="language-matlab"> <span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">I</span><span class="p">]</span> <span class="p">=</span> <span class="n">gather</span><span class="p">(</span><span class="n">timeBase</span><span class="p">,</span><span class="n">MidPrice</span><span class="p">,</span><span class="n">ImbalanceIndex</span><span class="p">);</span>
 <span class="n">Evaluating</span> <span class="n">tall</span> <span class="n">expression</span> <span class="n">using</span> <span class="n">the</span> <span class="n">Local</span> <span class="n">MATLAB</span> <span class="n">Session</span><span class="p">:</span>
 <span class="o">-</span> <span class="n">Pass</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Completed</span> <span class="n">in</span> <span class="mf">2.1</span> <span class="nb">sec</span>
 <span class="n">Evaluation</span> <span class="n">completed</span> <span class="n">in</span> <span class="mf">2.3</span> <span class="nb">sec</span></code></pre></div><p data-pid="OXq3eiTb">一次<code>gather</code>调用即可通过数据仓库一次评估多个预处理表达式。</p><p data-pid="tYssCfhy">确定样本大小，即数据中更新的数量。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">numTicks</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
 <span class="n">numTicks</span> <span class="p">=</span> <span class="mi">581030</span></code></pre></div><p data-pid="GgtBtzYY">每日LOB数据包含581,030个更新。</p><h3><b>检查点数据</b></h3><p data-pid="o80tjWOD">您可以将未评估和评估的数据都保存到外部存储中，以备后用。</p><p data-pid="Tc_QGjwE">在时基前加上日期，并将结果转换为datetime数组。保存所得到的日期时间阵列 <code>MidPrice</code>和<code>ImbalanceIndex</code>到在指定位置MAT文件。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">dateTimeBase</span> <span class="p">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="n">timeBase</span><span class="p">;</span> 
 <span class="n">Today</span> <span class="p">=</span> <span class="n">timetable</span><span class="p">(</span><span class="n">dateTimeBase</span><span class="p">,</span><span class="n">MidPrice</span><span class="p">,</span><span class="n">ImbalanceIndex</span><span class="p">)</span>
 <span class="n">Today</span> <span class="p">=</span>
 ?
   <span class="mi">581</span><span class="p">,</span><span class="mi">030</span>×<span class="mi">2</span> <span class="n">tall</span> <span class="n">timetable</span>
 ?
         <span class="n">dateTimeBase</span>         <span class="n">MidPrice</span>     <span class="n">ImbalanceIndex</span>
     <span class="n">____________________</span>    <span class="n">__________</span>    <span class="n">______________</span>
 ?
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>         <span class="o">-</span><span class="mf">0.205</span>   
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>       <span class="o">-</span><span class="mf">0.26006</span>   
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>       <span class="o">-</span><span class="mf">0.26006</span>   
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>      <span class="o">-</span><span class="mf">0.086772</span>   
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>       <span class="o">-</span><span class="mf">0.15581</span>   
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>       <span class="o">-</span><span class="mf">0.35382</span>   
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>       <span class="o">-</span><span class="mf">0.19084</span>   
     <span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">09</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.7515e+05</span>       <span class="o">-</span><span class="mf">0.19084</span>   
              <span class="p">:</span>                  <span class="p">:</span>               <span class="p">:</span>
              <span class="p">:</span>                  <span class="p">:</span>               <span class="p">:</span>
 <span class="n">location</span> <span class="p">=</span> <span class="n">fullfile</span><span class="p">(</span><span class="n">pwd</span><span class="p">,</span>&#34;<span class="n">ExchangeData</span>&#34;<span class="p">,</span><span class="n">ticker</span><span class="p">,</span><span class="n">date</span><span class="p">);</span>
 <span class="n">write</span><span class="p">(</span><span class="n">location</span><span class="p">,</span><span class="n">Today</span><span class="p">,</span><span class="s">&#39;FileType&#39;</span><span class="p">,</span><span class="s">&#39;mat&#39;</span><span class="p">)</span>
 <span class="n">Writing</span> <span class="n">tall</span> <span class="n">data</span> <span class="n">to</span> <span class="n">folder</span> <span class="n">I</span><span class="p">:</span><span class="o">\</span><span class="n">Documents</span><span class="o">\</span><span class="n">examples</span><span class="o">\</span><span class="n">examples</span><span class="o">\</span><span class="n">finance</span><span class="o">-</span><span class="n">ex97702880</span><span class="o">\</span><span class="n">ExchangeData</span><span class="o">\</span><span class="n">INTC</span><span class="o">\</span><span class="mi">2012</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">21</span>
 <span class="n">Evaluating</span> <span class="n">tall</span> <span class="n">expression</span> <span class="n">using</span> <span class="n">the</span> <span class="n">Local</span> <span class="n">MATLAB</span> <span class="n">Session</span><span class="p">:</span>
 <span class="o">-</span> <span class="n">Pass</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Completed</span> <span class="n">in</span> <span class="mi">3</span> <span class="nb">sec</span>
 <span class="n">Evaluation</span> <span class="n">completed</span> <span class="n">in</span> <span class="mf">3.3</span> <span class="nb">sec</span></code></pre></div><p data-pid="FREt7U_n">在每个交易日结束时，文件被写入一次。该代码将数据保存到带日期戳的文件夹中的文件中。该系列<code>ExchangeData</code>子文件夹用作历史数据存储库。</p><p data-pid="xDK4GZjm">或者，您可以将使用<code>gather</code>计算的工作空间变量直接保存到当前文件夹中的MAT文件中。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">save</span><span class="p">(</span>&#34;<span class="n">LOBVars</span><span class="p">.</span><span class="n">mat</span>&#34;<span class="p">,</span>&#34;<span class="n">t</span>&#34;<span class="p">,</span>&#34;<span class="n">S</span>&#34;<span class="p">,</span>&#34;<span class="n">I</span>&#34;<span class="p">)</span></code></pre></div><p data-pid="dQbCxao6">在准备稍后进行模型验证时，请评估市场定单价格并将其添加到同一文件中。</p><div class="highlight"><pre><code class="language-matlab"> <span class="p">[</span><span class="n">MOBid</span><span class="p">,</span><span class="n">MOAsk</span><span class="p">]</span> <span class="p">=</span> <span class="n">gather</span><span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidPrice1</span><span class="p">,</span><span class="n">DTT</span><span class="p">.</span><span class="n">AskPrice1</span><span class="p">);</span>
 <span class="n">Evaluating</span> <span class="n">tall</span> <span class="n">expression</span> <span class="n">using</span> <span class="n">the</span> <span class="n">Local</span> <span class="n">MATLAB</span> <span class="n">Session</span><span class="p">:</span>
 <span class="o">-</span> <span class="n">Pass</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Completed</span> <span class="n">in</span> <span class="mf">1.8</span> <span class="nb">sec</span>
 <span class="n">Evaluation</span> <span class="n">completed</span> <span class="n">in</span> <span class="mf">1.9</span> <span class="nb">sec</span>
 <span class="n">save</span><span class="p">(</span>&#34;<span class="n">LOBVars</span><span class="p">.</span><span class="n">mat</span>&#34;<span class="p">,</span>&#34;<span class="n">MOBid</span>&#34;<span class="p">,</span>&#34;<span class="n">MOAsk</span>&#34;<span class="p">,</span>&#34;<span class="o">-</span><span class="n">append</span>&#34;<span class="p">)</span></code></pre></div><p data-pid="N51loNJb">本示例的其余部分仅使用未经计算的Tall时间表DTT。从工作空间中清除其他变量。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">clearvars</span> <span class="o">-</span><span class="n">except</span> <span class="n">DTT</span> 
 <span class="n">whos</span>
   <span class="n">Name</span>            <span class="n">Size</span>            <span class="n">Bytes</span>  <span class="n">Class</span>    <span class="n">Attributes</span>
 ?
   <span class="n">DTT</span>       <span class="mi">581</span><span class="p">,</span><span class="mi">030</span><span class="n">x12</span>             <span class="mi">4512</span>  <span class="n">tall</span>               </code></pre></div><h3><b>数据可视化</b></h3><p data-pid="LZMLWVGz">要可视化大量数据，必须以某种方式汇总，分类或以某种方式采样数据，以减少在屏幕上绘制的点数。</p><h3><b>LOB快照</b></h3><p data-pid="GrxDzl3c">可视化的一种方法是仅评估数据的选定子样本。在一天的特定时间（上午11点）创建LOB的快照。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">sampleTimeTarget</span> <span class="p">=</span> <span class="n">seconds</span><span class="p">(</span><span class="mi">11</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">);</span>               <span class="c">% Seconds after midnight</span>
 <span class="n">sampleTimes</span> <span class="p">=</span> <span class="n">withtol</span><span class="p">(</span><span class="n">sampleTimeTarget</span><span class="p">,</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span> <span class="c">% 1 second tolerance</span>
 <span class="n">sampleLOB</span> <span class="p">=</span> <span class="n">DTT</span><span class="p">(</span><span class="n">sampleTimes</span><span class="p">,:);</span>
 ?
 <span class="n">numTimes</span> <span class="p">=</span> <span class="n">gather</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">sampleLOB</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
 <span class="n">Evaluating</span> <span class="n">tall</span> <span class="n">expression</span> <span class="n">using</span> <span class="n">the</span> <span class="n">Local</span> <span class="n">MATLAB</span> <span class="n">Session</span><span class="p">:</span>
 <span class="o">-</span> <span class="n">Pass</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Completed</span> <span class="n">in</span> <span class="mf">2.1</span> <span class="nb">sec</span>
 <span class="n">Evaluation</span> <span class="n">completed</span> <span class="n">in</span> <span class="mf">2.2</span> <span class="nb">sec</span>
 <span class="n">numTimes</span> <span class="p">=</span> <span class="mi">23</span></code></pre></div><p data-pid="hof2pwpB">在上午11点的一秒内有23个数据更新。对于快照，请使用最接近中间时间的数据中值。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">sampleLOB</span> <span class="p">=</span> <span class="n">sampleLOB</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">numTimes</span><span class="o">/</span><span class="mi">2</span><span class="p">),:);</span>
 <span class="n">sampleTime</span> <span class="p">=</span> <span class="n">sampleLOB</span><span class="p">.</span><span class="n">Time</span><span class="p">;</span>
 ?
 <span class="n">sampleBidPrices</span> <span class="p">=</span> <span class="p">[</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">BidPrice1</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">BidPrice2</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">BidPrice3</span><span class="p">];</span>
 <span class="n">sampleBidSizes</span>  <span class="p">=</span> <span class="p">[</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">BidSize1</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">BidSize2</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">BidSize3</span><span class="p">];</span>
 <span class="n">sampleAskPrices</span> <span class="p">=</span> <span class="p">[</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">AskPrice1</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">AskPrice2</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">AskPrice3</span><span class="p">];</span>
 <span class="n">sampleAskSizes</span>  <span class="p">=</span> <span class="p">[</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">AskSize1</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">AskSize2</span><span class="p">,</span><span class="n">sampleLOB</span><span class="p">.</span><span class="n">AskSize3</span><span class="p">];</span>
 ?
 <span class="p">[</span><span class="n">sampleTime</span><span class="p">,</span><span class="n">sampleBidPrices</span><span class="p">,</span><span class="n">sampleBidSizes</span><span class="p">,</span><span class="n">sampleAskPrices</span><span class="p">,</span><span class="n">sampleAskSizes</span><span class="p">]</span> <span class="p">=</span> <span class="c">...</span>
     <span class="n">gather</span><span class="p">(</span><span class="n">sampleTime</span><span class="p">,</span><span class="n">sampleBidPrices</span><span class="p">,</span><span class="n">sampleBidSizes</span><span class="p">,</span><span class="n">sampleAskPrices</span><span class="p">,</span><span class="n">sampleAskSizes</span><span class="p">);</span>
 <span class="n">Evaluating</span> <span class="n">tall</span> <span class="n">expression</span> <span class="n">using</span> <span class="n">the</span> <span class="n">Local</span> <span class="n">MATLAB</span> <span class="n">Session</span><span class="p">:</span>
 <span class="o">-</span> <span class="n">Pass</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Completed</span> <span class="n">in</span> <span class="mf">1.8</span> <span class="nb">sec</span>
 <span class="o">-</span> <span class="n">Pass</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Completed</span> <span class="n">in</span> <span class="mf">2.1</span> <span class="nb">sec</span>
 <span class="n">Evaluation</span> <span class="n">completed</span> <span class="n">in</span> <span class="mf">4.3</span> <span class="nb">sec</span></code></pre></div><p data-pid="04FG-Evn">通过使用<code>bar</code>，可视化由<code>gather</code>返回的有限的数据样本。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">figure</span>
 <span class="n">hold</span> <span class="n">on</span>
 ?
 <span class="n">bar</span><span class="p">((</span><span class="n">sampleBidPrices</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span><span class="n">sampleBidSizes</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
 <span class="n">bar</span><span class="p">((</span><span class="n">sampleAskPrices</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span><span class="n">sampleAskSizes</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
 <span class="n">hold</span> <span class="n">off</span>
 ?
 <span class="n">xlabel</span><span class="p">(</span>&#34;<span class="n">Price</span> <span class="p">(</span><span class="n">Dollars</span><span class="p">)</span>&#34;<span class="p">)</span>
 <span class="n">ylabel</span><span class="p">(</span>&#34;<span class="n">Number</span> <span class="n">of</span> <span class="n">Shares</span>&#34;<span class="p">)</span>
 <span class="n">legend</span><span class="p">([</span>&#34;<span class="n">Bid</span>&#34;<span class="p">,</span>&#34;<span class="n">Ask</span>&#34;<span class="p">],</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;North&#39;</span><span class="p">)</span>
 <span class="n">title</span><span class="p">(</span><span class="n">strcat</span><span class="p">(</span>&#34;<span class="n">Level</span> <span class="mi">3</span> <span class="n">Limit</span> <span class="n">Order</span> <span class="n">Book</span><span class="p">:</span> &#34;<span class="p">,</span><span class="n">datestr</span><span class="p">(</span><span class="n">sampleTime</span><span class="p">,</span>&#34;<span class="n">HH</span><span class="p">:</span><span class="n">MM</span><span class="p">:</span><span class="n">SS</span>&#34;<span class="p">)))</span></code></pre></div><br><img src="v2-9eb196e8037e3cdf23c8627cc913b13c_720w.jpg"><h3><b>市场深度</b></h3><p data-pid="SS49d8HH">一些可视化函数直接与Tall阵列一起使用，不需要使用<code>gather</code> 。这些函数自动对数据进行采样以降低像素密度。通过使用时间表<code>DTT</code>和绘图函数<code>plot</code>，可视化三级盘中交易的<i>深度</i>，从而显示流动性的时间演变。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">figure</span>
 <span class="n">hold</span> <span class="n">on</span>
 ?
 <span class="n">plot</span><span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span><span class="o">-</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidSize1</span><span class="p">,</span><span class="s">&#39;Color&#39;</span><span class="p">,[</span><span class="mf">1.0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">],</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
 <span class="n">plot</span><span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span><span class="o">-</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidSize2</span><span class="p">,</span><span class="s">&#39;Color&#39;</span><span class="p">,[</span><span class="mf">0.8</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">],</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
 <span class="n">plot</span><span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span><span class="o">-</span><span class="n">DTT</span><span class="p">.</span><span class="n">BidSize3</span><span class="p">,</span><span class="s">&#39;Color&#39;</span><span class="p">,[</span><span class="mf">0.6</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">],</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
 ?
 <span class="n">plot</span><span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span><span class="n">DTT</span><span class="p">.</span><span class="n">AskSize1</span><span class="p">,</span><span class="s">&#39;Color&#39;</span><span class="p">,[</span><span class="mi">0</span> <span class="mf">1.0</span> <span class="mi">0</span><span class="p">],</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
 <span class="n">plot</span><span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span><span class="n">DTT</span><span class="p">.</span><span class="n">AskSize2</span><span class="p">,</span><span class="s">&#39;Color&#39;</span><span class="p">,[</span><span class="mi">0</span> <span class="mf">0.8</span> <span class="mi">0</span><span class="p">],</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
 <span class="n">plot</span><span class="p">(</span><span class="n">DTT</span><span class="p">.</span><span class="n">Time</span><span class="p">,</span><span class="n">DTT</span><span class="p">.</span><span class="n">AskSize3</span><span class="p">,</span><span class="s">&#39;Color&#39;</span><span class="p">,[</span><span class="mi">0</span> <span class="mf">0.6</span> <span class="mi">0</span><span class="p">],</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
 ?
 <span class="n">hold</span> <span class="n">off</span>
 ?
 <span class="n">xlabel</span><span class="p">(</span>&#34;<span class="n">Time</span>&#34;<span class="p">)</span>
 <span class="n">ylabel</span><span class="p">(</span>&#34;<span class="n">Number</span> <span class="n">of</span> <span class="n">Shares</span>&#34;<span class="p">)</span>
 <span class="n">title</span><span class="p">(</span>&#34;<span class="n">Depth</span> <span class="n">of</span> <span class="n">Market</span><span class="p">:</span> <span class="n">Intraday</span> <span class="n">Evolution</span>&#34;<span class="p">)</span>
 <span class="n">legend</span><span class="p">([</span>&#34;<span class="n">Bid1</span>&#34;<span class="p">,</span>&#34;<span class="n">Bid2</span>&#34;<span class="p">,</span>&#34;<span class="n">Bid3</span>&#34;<span class="p">,</span>&#34;<span class="n">Ask1</span>&#34;<span class="p">,</span>&#34;<span class="n">Ask2</span>&#34;<span class="p">,</span>&#34;<span class="n">Ask3</span>&#34;<span class="p">],</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;NorthOutside&#39;</span><span class="p">,</span><span class="s">&#39;Orientation&#39;</span><span class="p">,</span><span class="s">&#39;Horizontal&#39;</span><span class="p">);</span></code></pre></div><br><img src="v2-84f14932ad15f2e4c181135134fac222_720w.jpg"><p data-pid="bs03VDJB">要显示详细信息，请限制时间间隔。</p><div class="highlight"><pre><code class="language-matlab"> <span class="n">xlim</span><span class="p">(</span><span class="n">seconds</span><span class="p">([</span><span class="mi">45000</span> <span class="mi">45060</span><span class="p">]))</span>
 <span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">35000</span> <span class="mi">35000</span><span class="p">])</span>
 <span class="n">title</span><span class="p">(</span>&#34;<span class="n">Depth</span> <span class="n">of</span> <span class="n">Market</span><span class="p">:</span> <span class="n">One</span> <span class="n">Minute</span>&#34;<span class="p">)</span></code></pre></div><br><img src="v2-99dadba56bb29d0cf63732589bb655da_720w.jpg"><h3><b>概要</b></h3><p data-pid="K15l0PrU">本示例介绍了在内存内部以及外部使用大数据的基础知识。它显示了如何设置，组合和更新外部数据存储，然后创建用于处理数据的Tall数组，而无需在MATLAB工作区中分配变量。<code>gather</code>函数将数据传输到工作空间中以进行计算和进一步分析。该示例显示了如何通过数据采样或通过直接对内存不足数据起作用的MATLAB绘图功能来可视化数据。</p><h2><b>参考文献</b></h2><p data-pid="Lgqxl_KQ">[1] <a href="https://lobsterdata.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">LOBSTER Limit Order Book Data</a>. Berlin: frischedaten UG (haftungsbeschr?nkt).</p><p data-pid="JTp_xqfU">[2] <a href="https://nasdaqtrader.com/Trader.aspx%3Fid%3DITCH" class=" wrap external" target="_blank" rel="nofollow noreferrer">NASDAQ Historical TotalView-ITCH Data</a>. New York: The Nasdaq, Inc.</p><p data-pid="dx62OFi5">[3] Rubisov, Anton D. &#34;<a href="https://tspace.library.utoronto.ca/bitstream/1807/70567/3/Rubisov_Anton_201511_MAS_thesis.pdf" class=" wrap external" target="_blank" rel="nofollow noreferrer">Statistical Arbitrage Using Limit Order Book Imbalance</a>.&#34; Master&#39;s thesis, University of Toronto, 2015.</p><hr/><p data-pid="_n-hwZ1n">注：本文根据MATLAB官网内容修改而成。</p>
</p>
<p>
<br> ======================================================================
<br><strong> 我的测试结果及程序  </strong>
<br>下面是我测试的代码：
<pre>

 
</pre>
<br> <img src="myTestResult.png"   width="868px" height="478px">


</p>



                            </div>
                        </article>
                    </div>
                </div>
            </div>
          <footer id="colophon" role="contentinfo">
	<div id="site-generator">孙悟空 from 吉林大学自动化 @ sunwukong@sangkeji.com</div>
	<script src="../../../footer.js"></script>
          </footer>
        </div>
    </body>
</html>
