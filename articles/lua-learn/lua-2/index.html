<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Lua基础知识</title>
        <link rel="stylesheet" type="text/css" media="all" href="../../../style.css">
    </head>
    <body class="post-template-default single single-post postid-14 single-format-standard logged-in admin-bar single-author singular two-column left-sidebar customize-support">
        <div id="page" class="hfeed">
            <div id="main">
                <div id="primary">
                    <div id="content" role="main">        
                        <article id="post-14" class="post-14 post type-post status-publish format-standard hentry category-18">
                            <header class="entry-header">
                                <h1 class="entry-title">Lua基础知识</h1>
                            </header>
                            <div class="entry-content">
<br><a href="../../../index.html"> Home </a> 
<br>
<br>
<p>
<p><span style="font-size: 14pt;"><strong><span style="color: rgba(255, 0, 0, 1);">一、基础知识：</span></strong></span><br /><br />&nbsp;&nbsp; &nbsp;<span style="color: rgba(128, 0, 128, 1); font-size: 15px;">1. 第一个程序和函数：</span><br />&nbsp;&nbsp; &nbsp;在目前这个学习阶段，运行Lua程序最好的方式就是通过Lua自带的解释器程序，如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;/&gt; lua</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print("Hello World")</span><br />&nbsp;&nbsp; &nbsp;<span style="color: rgba(0, 128, 0, 1);">Hello World</span><br />&nbsp;&nbsp; &nbsp;这样我们就可以以交互性的方式输入lua代码，并立即得到执行结果了。对于代码块较少的测试程序来说，这种方式确实是非常方便的，然而对于相对复杂的程序而言，这种方式就不是很合适了。如果是这样，我们可以将Lua代码保存到一个独立的Lua程序文件中，之后再通过Lua解释器程序以命令行参数的形式执行文件中的Lua代码。如我们将下面的Lua代码保存到test.lua的文件中：</p>
<div class="cnblogs_code">
<pre> <span style="color: rgba(0, 0, 255, 1);">function</span> fact(n)<br />     <span style="color: rgba(0, 0, 255, 1);">if</span> n == <span style="color: rgba(128, 0, 128, 1);">0</span> <span style="color: rgba(0, 0, 255, 1);">then</span><br />         <span style="color: rgba(0, 0, 255, 1);">return</span> <span style="color: rgba(128, 0, 128, 1);">1</span><br />     <span style="color: rgba(0, 0, 255, 1);">else</span><br />         <span style="color: rgba(0, 0, 255, 1);">return</span> n * fact(n - <span style="color: rgba(128, 0, 128, 1);">1</span>)<br />     <span style="color: rgba(0, 0, 255, 1);">end</span><br /> <span style="color: rgba(0, 0, 255, 1);">end</span><br /> <span style="color: rgba(255, 0, 255, 1);">print</span>(<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">Enter a number:</span><span style="color: rgba(128, 0, 0, 1);">"</span>)<br /> a = <span style="color: rgba(255, 0, 255, 1);">io.read</span>(<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">*number</span><span style="color: rgba(128, 0, 0, 1);">"</span>)<br /><span style="color: rgba(255, 0, 255, 1);">print</span>(fact(a))</pre>
</div>
<p><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp;&nbsp; /&gt; lua D:/test.lua</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;Enter a number:</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;4</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;24<br /><br /><span style="font-size: 15px; color: rgba(128, 0, 128, 1);">&nbsp;&nbsp; &nbsp;2. 代码规范：</span><br /><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp; &nbsp;1). Lua的多条语句之间并不要求任何分隔符，如C语言的分号(;)，其中换行符也同样不能起到语句分隔的作用。因此下面的写法均是合法的。如：</span><br /></span></p>
<div class="cnblogs_code">
<pre>a = <span style="color: rgba(128, 0, 128, 1);">1</span><br />b = a * <span style="color: rgba(128, 0, 128, 1);">2</span><br />    <br />a = <span style="color: rgba(128, 0, 128, 1);">1</span>;<br />b = a * <span style="color: rgba(128, 0, 128, 1);">2</span>;<br />    <br />a = <span style="color: rgba(128, 0, 128, 1);">1</span>; b = a * <span style="color: rgba(128, 0, 128, 1);">2</span>;<br />a = <span style="color: rgba(128, 0, 128, 1);">1</span>  b = a * <span style="color: rgba(128, 0, 128, 1);">2</span></pre>
</div>
<p><span style="color: rgba(0, 128, 0, 1);"><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp;&nbsp; 2). 通过dofile()方法引用其他Lua文件中的函数，如：</span><br /></span></p>
<div class="cnblogs_code">
<pre><span style="color: rgba(0, 0, 255, 1);">function</span> fact(n)<br />    <span style="color: rgba(0, 0, 255, 1);">if</span> n == <span style="color: rgba(128, 0, 128, 1);">0</span> <span style="color: rgba(0, 0, 255, 1);">then</span><br />        <span style="color: rgba(0, 0, 255, 1);">return</span> <span style="color: rgba(128, 0, 128, 1);">1</span><br />    <span style="color: rgba(0, 0, 255, 1);">else</span><br />        <span style="color: rgba(0, 0, 255, 1);">return</span> n * fact(n - <span style="color: rgba(128, 0, 128, 1);">1</span>)<br />    <span style="color: rgba(0, 0, 255, 1);">end</span><br /><span style="color: rgba(0, 0, 255, 1);">end</span></pre>
</div>
<p><span style="color: rgba(0, 128, 0, 1);"><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp;&nbsp; 将上面的函数保存到test2.lua文件中。</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;/&gt; lua</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; dofile("d:/test2.lua")</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(fact(4))</span><br />&nbsp;&nbsp; &nbsp;24<br /><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp; &nbsp;3). 词法规范。</span><br /><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp; &nbsp;和大多数其它语言一样，在声明变量时，变量名可以由任意字母、数字和下划线构成，但是不能以数字开头。在Lua中还有一个特殊的规则，即以下划线(_)开头，后面紧随多个大写字母(<span style="color: rgba(0, 0, 255, 1);">_VERSION</span>)，这些变量一般被Lua保留并用于特殊用途，因此我们在声明变量时需要尽量避免这样的声明方式，以免给后期的维护带来不必要的麻烦。</span><br /><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp; &nbsp;Lua是大小写敏感的，因此对于一些Lua保留关键字的使用要特别小心，如and。但是And和AND则不是Lua的保留字。</span><br /><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp; &nbsp;4). Lua中的注释分为两种，一种是单行注释，如：</span><br /></span><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;--This is a single line comment.</span><br /><span style="color: rgba(0, 128, 0, 1);"><span style="color: rgba(0, 0, 0, 1);">&nbsp;&nbsp; &nbsp;另外一种是多行注释，如：</span><br /></span><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;--[[</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;This is a multi-lines comment.</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;--]]</span><br /><br />&nbsp;&nbsp; &nbsp;<span style="color: rgba(128, 0, 128, 1); font-size: 15px;">3. 全局变量：</span><br />&nbsp;&nbsp; &nbsp;在Lua中全局变量不需要声明，直接赋值即可。如果直接访问未初始化的全局变量，Lua也不会报错，直接返回nil。如果不想再使用该全局变量，可直接将其置为nil。如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;/&gt; lua</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(b)</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;nil</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; b = 10</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(b)</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;10</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; b = nil</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(b)</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;nil</span><br />&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp; <span style="font-size: 15px; color: rgba(128, 0, 128, 1);">&nbsp;4. 解释器程序：</span><br />&nbsp;&nbsp; &nbsp;命令行用法如下：<br />&nbsp;&nbsp; &nbsp;<strong><span style="color: rgba(0, 0, 255, 1);">lua [options] [lua-script [arguments] ]</span></strong><br />&nbsp;&nbsp; &nbsp;该工具的命令行选项主要有以下3个：<br />&nbsp;&nbsp; &nbsp;<strong><span style="color: rgba(0, 0, 255, 1);">-e</span></strong>: 可以直接执行命令行中Lua代码，如：lua -e "print(\"Hello World\")"<br />&nbsp;&nbsp; &nbsp;<strong><span style="color: rgba(0, 0, 255, 1);">-l</span></strong>: 加载该选项后的Lua库文件，如：lua -l mylib -e "x = 10"，该命令在执行之前先将mylib中的Lua代码加载到内存中，在后面的命令中就可以直接使用该文件中定义的Lua函数了。<br />&nbsp;&nbsp; &nbsp;<strong><span style="color: rgba(0, 0, 255, 1);">-i</span></strong>: 在执行完指定的Lua程序文件之后，并不退出解释器程序，而是直接进入该程序的交互模式。&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;在解释器程序的交互模式下，我们可以通过在表达式前加等号(=)标识符的方式直接输出表达式的执行结果。通过该方式，我们可以将该程序用于计算器，如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;/&gt; lua</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; = 3 + 1 + 4</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;8</span><br />&nbsp;&nbsp; &nbsp;该小节最后需要介绍的是lua脚本的命令行参数访问规则。如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;/&gt; lua lua-script.lua a b c</span><br />&nbsp;&nbsp; &nbsp;在该脚本的程序入口，lua解释器会将所有命令行参数创建一个名为arg的table。其中脚本名(lua-script.lua)位于table索引的0位置上。它的第一个参数(a)则位于索引1，其它的参数以此类推。这种索引方式和C语言中读取命令行参数的规则相同。但是不同的是，Lua提供了负数索引，用以访问脚本名称之前的命令行参数，如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;arg[-1] = lua</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;arg[0] = lua-script.lua</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;arg[1] = a</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;arg[2] = b</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;arg[3] = c</span><br /><br /><span style="font-size: 14pt;"><strong><span style="color: rgba(255, 0, 0, 1);">二、类型与值：</span></strong></span><br /><br />&nbsp;&nbsp; &nbsp;Lua是一种动态类型的语言。其语言本身没有提供类型定义的语法，每个值都&ldquo;携带&rdquo;了它自身的类型信息。在Lua中有8中基础类型，分别是：nil、boolean、number、string、userdata、function、thread和table。我们可以通过type函数获得变量的类型信息，该类型信息将以字符串的形式返回。如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(type("hello world"))</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;string</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(type(10.4))</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;number</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(type(print))</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;function</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(type(true))</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;boolean</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(type(nil))</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;nil</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(type(type(X)))</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;string</span><br /><br />&nbsp;&nbsp;&nbsp; <span style="color: rgba(128, 0, 128, 1); font-size: 15px;">1. nil(空)：</span><br />&nbsp;&nbsp; &nbsp;nil是一种类型，它只有一个值nil，它的主要功能是由于区别其他任何值。就像之前所说的，一个全局变量在第一次赋值前的默认值的默认值就是nil，将nil赋予一个全局变量等同于删除它。Lua将nil用于表示一种&ldquo;无效值&rdquo;的情况。<br />&nbsp;&nbsp; &nbsp;<br /><span style="color: rgba(128, 0, 128, 1); font-size: 15px;">&nbsp;&nbsp; &nbsp;2. boolean(布尔)：</span><br />&nbsp;&nbsp; &nbsp;该类型有两个可选值：false和true。在Lua中只有当值是false和nil时才视为&ldquo;假&rdquo;，其它值均视为真，如数字零和空字符串，这一点和C语言是不同的。<br />&nbsp;&nbsp; &nbsp;<br /><span style="color: rgba(128, 0, 128, 1); font-size: 15px;">&nbsp;&nbsp; &nbsp;3. number(数字)：</span><br />&nbsp;&nbsp; &nbsp;Lua中的number用于表示实数。Lua中没有专门的类型表示整数。<br />&nbsp;&nbsp; &nbsp;<br /><span style="color: rgba(128, 0, 128, 1); font-size: 15px;">&nbsp;&nbsp; &nbsp;4. string(字符串)：</span><br />&nbsp;&nbsp; &nbsp;Lua中的字符串通常表示&ldquo;一个字符序列&rdquo;。字符串类型的变量是不可变的，因此不能像C语言中那样直接修改字符串的某一个字符，而是在修改的同时创建了新的字符串。如：</p>
<div class="cnblogs_code">
<pre>a = <span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">one string</span><span style="color: rgba(128, 0, 0, 1);">"</span><br />b = <span style="color: rgba(255, 0, 255, 1);">string.gsub</span>(a,<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">one</span><span style="color: rgba(128, 0, 0, 1);">"</span>,<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">another</span><span style="color: rgba(128, 0, 0, 1);">"</span>)<br /><span style="color: rgba(255, 0, 255, 1);">print</span>(a)<br /><span style="color: rgba(255, 0, 255, 1);">print</span>(b)</pre>
</div>
<p><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp;&nbsp; /&gt; lua d:/test.lua&nbsp;&nbsp; &nbsp;</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;one string</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;anotner string</span><br />&nbsp;&nbsp;&nbsp; Lua支持和C语言类似的字符转义序列，见下表：</p>
<table style="width: 500px;" border="0" align="center">
<tbody>
<tr>
<td style="text-align: center;"><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">转义符</span></td>
<td style="text-align: center;"><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">描述</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\a</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">响铃</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\b</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">退格</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\n</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">换行</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\r</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">回车</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\t</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">水平Tab</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\\</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">反斜杠</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\"</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">双引号</span></td>
</tr>
<tr>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">\'</span></td>
<td><span style="color: rgba(0, 0, 255, 1); font-size: 12px;">单引号</span></td>
</tr>
</tbody>
</table>
<p>&nbsp;&nbsp;&nbsp; 在Lua中还可以通过<span style="color: rgba(0, 0, 255, 1);">[[ all strings ]]</span>的方式来禁用<strong><span style="color: rgba(0, 0, 255, 1);">[[ ]]</span></strong>中转义字符，如：<br />&nbsp;&nbsp; &nbsp;<span style="color: rgba(0, 0, 255, 1);">page = [[ &lt;html&gt; &lt;head&gt; &lt;title&gt; An Html Page &lt;/title&gt; &lt;/head&gt; ]]</span><br />&nbsp;&nbsp; &nbsp;如果两个方括号中包含这样的内容：a = b[c[i]]，这样将会导致Lua的误解析，因此在这种情况下，我们可以将其改为<strong><span style="color: rgba(0, 0, 255, 1);">[===[</span></strong> 和<strong><span style="color: rgba(0, 0, 255, 1);"> ]===]</span></strong>的形式，从而避免了误解析的发生。<br />&nbsp;&nbsp; &nbsp;Lua提供了运行时的数字与字符串的自动转换。如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print("10" + 1)</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;11</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print("10 + 1")</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;10 + 1</span><br />&nbsp;&nbsp; &nbsp;如果在实际编程中，不希望两个数字字符串被自动转换，而是实现字符串之间的连接，可以通过<span style="color: rgba(0, 0, 255, 1);"><strong>" .. "</strong></span>操作符来完成。如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;&gt; print(10 .. 20)</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;1020</span><br />&nbsp;&nbsp; &nbsp;注意..和两边的数字之间必须留有空格，否则就会被Lua误解析为小数点儿。<br />&nbsp;&nbsp; &nbsp;尽管Lua提供了这种自动转换的功能，为了避免一些不可预测的行为发生，特别是因为Lua版本升级而导致的行为不一致现象。鉴于此，还是应该尽可能使用显示的转换，如字符串转数字的函数<strong><span style="color: rgba(0, 0, 255, 1);">tonumber()</span></strong>，或者是数字转字符串的函数<strong><span style="color: rgba(0, 0, 255, 1);">tostring()</span></strong>。对于前者，如果函数参数不能转换为数字，该函数返回nil。如：</p>
<div class="cnblogs_code">
<pre>line = <span style="color: rgba(255, 0, 255, 1);">io.read</span>()<br />n = <span style="color: rgba(255, 0, 255, 1);">tonumber</span>(line)<br /><span style="color: rgba(0, 0, 255, 1);">if</span> n == <span style="color: rgba(0, 0, 255, 1);">nil</span> <span style="color: rgba(0, 0, 255, 1);">then</span><br />    <span style="color: rgba(255, 0, 255, 1);">error</span>(line .. <span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);"> is not a valid number</span><span style="color: rgba(128, 0, 0, 1);">"</span>)<br /><span style="color: rgba(0, 0, 255, 1);">else</span><br />    <span style="color: rgba(255, 0, 255, 1);">print</span>(n * <span style="color: rgba(128, 0, 128, 1);">2</span>)<br /><span style="color: rgba(0, 0, 255, 1);">end</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp; 关于Lua的字符串最后需要介绍的是<strong><span style="color: rgba(0, 0, 255, 1);">"#"</span></strong>标识符，该标识符在字符串变量的前面将返回其后字符串的长度，如：</p>
<div class="cnblogs_code">
<pre>a = <span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">hello</span><span style="color: rgba(128, 0, 0, 1);">"</span><br /><span style="color: rgba(255, 0, 255, 1);">print</span>(#a)</pre>
</div>
<p><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp;&nbsp; /&gt; lua d:/test.lua</span><br /><span style="color: rgba(0, 128, 0, 1);">&nbsp;&nbsp; &nbsp;5</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <br /><span style="color: rgba(128, 0, 128, 1); font-size: 15px;">&nbsp;&nbsp; &nbsp;5. table(表)：</span><br />&nbsp;&nbsp; &nbsp;我们可以将Lua中table类型视为&ldquo;关联数组&rdquo;，如C++标准库中的map，差别是Lua中table的键(key)可以为任意类型(nil除外)，而map中的键只能为模参类型。此外，table没有固定的大小，可以动态的添加任意数量的元素到一个table中。table是Lua中最主要数据结构，其功能非常强大，可用于实现数组、集合、记录和队列数据结构。以下为table的变量声明，以及关联数据的初始化方式：</p>
<div class="cnblogs_code">
<pre>a = {}              <span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);"> 创建一个table对象，并将它的引用存储到a</span><span style="color: rgba(0, 128, 0, 1);"><br /></span>k = <span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">x</span><span style="color: rgba(128, 0, 0, 1);">"</span><br />a[k] = <span style="color: rgba(128, 0, 128, 1);">10</span>         <span style="color: rgba(0, 128, 0, 1);">  --</span><span style="color: rgba(0, 128, 0, 1);"> 创建了新条目，key = "x", value = 10</span><span style="color: rgba(0, 128, 0, 1);"><br /></span>a[<span style="color: rgba(128, 0, 128, 1);">20</span>] = <span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">great</span><span style="color: rgba(128, 0, 0, 1);">"</span>     <span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);"> 新条目，key = 20， value = "great"</span><span style="color: rgba(0, 128, 0, 1);"><br /></span><span style="color: rgba(255, 0, 255, 1);">print</span>(a[<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">x</span><span style="color: rgba(128, 0, 0, 1);">"</span>])<br />k = <span style="color: rgba(128, 0, 128, 1);">20</span><br /><span style="color: rgba(255, 0, 255, 1);">print</span>(a[k])         <span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);"> 打印great</span><span style="color: rgba(0, 128, 0, 1);"><br /></span>a[<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">x</span><span style="color: rgba(128, 0, 0, 1);">"</span>] = a[<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">x</span><span style="color: rgba(128, 0, 0, 1);">"</span>] + <span style="color: rgba(128, 0, 128, 1);">1</span><br /><span style="color: rgba(255, 0, 255, 1);">print</span>(a[<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">x</span><span style="color: rgba(128, 0, 0, 1);">"</span>])      <span style="color: rgba(0, 128, 0, 1);"> --</span><span style="color: rgba(0, 128, 0, 1);"> 打印11</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp; 所有的table都可以用不同类型的索引来访问value，当需要容纳新条目时，table会自动增长。</p>
<div class="cnblogs_code">
<pre> a = {}<br /> <span style="color: rgba(0, 0, 255, 1);">for</span> i = <span style="color: rgba(128, 0, 128, 1);">1</span>, <span style="color: rgba(128, 0, 128, 1);">100</span> <span style="color: rgba(0, 0, 255, 1);">do</span><br />     a[i] = i * <span style="color: rgba(128, 0, 128, 1);">2</span><br /> <span style="color: rgba(0, 0, 255, 1);">end</span><br /> <span style="color: rgba(255, 0, 255, 1);">print</span>(a[<span style="color: rgba(128, 0, 128, 1);">9</span>])<br /> a[<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">x</span><span style="color: rgba(128, 0, 0, 1);">"</span>] = <span style="color: rgba(128, 0, 128, 1);">10</span><br /> <span style="color: rgba(255, 0, 255, 1);">print</span>(a[<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">x</span><span style="color: rgba(128, 0, 0, 1);">"</span>])<br /> <span style="color: rgba(255, 0, 255, 1);">print</span>(a[<span style="color: rgba(128, 0, 0, 1);">"</span><span style="color: rgba(128, 0, 0, 1);">y</span><span style="color: rgba(128, 0, 0, 1);">"</span>])      <span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">table中的变量和全局变量一样，没有赋值之前均为nil。</span><span style="color: rgba(0, 128, 0, 1);"><br /></span> <br /><span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">输出结果为</span><span style="color: rgba(0, 128, 0, 1);"><br /></span><span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">18</span><span style="color: rgba(0, 128, 0, 1);"><br /></span><span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">10</span><span style="color: rgba(0, 128, 0, 1);"><br /></span><span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">nil</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp; 在Lua中还提供了另外一种方法用于访问table中的值，见如下示例：</p>
<div class="cnblogs_code">
<pre>a.x = <span style="color: rgba(128, 0, 128, 1);">10</span>      <span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">等同于a["x"] = 10</span><span style="color: rgba(0, 128, 0, 1);"><br /></span><span style="color: rgba(255, 0, 255, 1);">print</span>(a.x)    <span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">等同于print(a["x"])</span><span style="color: rgba(0, 128, 0, 1);"><br /></span><span style="color: rgba(255, 0, 255, 1);">print</span>(a.y)    <span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);">等同于print(a["y"])</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp; 对于Lua来说，这两种方式是等价的。但是对于开发者而言，点的写法隐式的将table表示为记录，既C语言中的结构体。而之前讲述的字符串表示法则意味着任何字符串均可作为table的key。<br />&nbsp;&nbsp; &nbsp;如果需要将table表示为传统的数组，只需将整数作为table的key即可。如：</p>
<div class="cnblogs_code">
<pre>a = {}<br /><span style="color: rgba(0, 0, 255, 1);">for</span> i = <span style="color: rgba(128, 0, 128, 1);">1</span>,<span style="color: rgba(128, 0, 128, 1);">10</span> <span style="color: rgba(0, 0, 255, 1);">do</span><br />    a[i] = i * <span style="color: rgba(128, 0, 128, 1);">2</span><br /><span style="color: rgba(0, 0, 255, 1);">end</span><br /><br /><span style="color: rgba(0, 0, 255, 1);">for</span> i = <span style="color: rgba(128, 0, 128, 1);">1</span>,<span style="color: rgba(128, 0, 128, 1);">10</span> <span style="color: rgba(0, 0, 255, 1);">do</span><br />    <span style="color: rgba(255, 0, 255, 1);">print</span>(a[i])<br /><span style="color: rgba(0, 0, 255, 1);">end</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp; 在Lua中，我通常习惯以1作为数组索引的起始值。而且还有不少内部机制依赖于这个惯例。如：</p>
<div class="cnblogs_code">
<pre>a = {}<br /><span style="color: rgba(0, 0, 255, 1);">for</span> i = <span style="color: rgba(128, 0, 128, 1);">1</span>,<span style="color: rgba(128, 0, 128, 1);">10</span> <span style="color: rgba(0, 0, 255, 1);">do</span><br />    a[i] = i * <span style="color: rgba(128, 0, 128, 1);">2</span><br /><span style="color: rgba(0, 0, 255, 1);">end</span><br /><br /><span style="color: rgba(0, 0, 255, 1);">for</span> i = <span style="color: rgba(128, 0, 128, 1);">1</span>,#a <span style="color: rgba(0, 0, 255, 1);">do</span><br />    <span style="color: rgba(255, 0, 255, 1);">print</span>(a[i])<br /><span style="color: rgba(0, 0, 255, 1);">end</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp; 由于数组实际上仍为一个table，所以对于数组大小的计算需要留意某些特殊的场景，如：<br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;a = {}</span><br /><span style="color: rgba(0, 0, 255, 1);">&nbsp;&nbsp; &nbsp;a[1000] = 1</span><br />&nbsp;&nbsp; &nbsp;在上面的示例中，数组a中索引值为1--999的元素的值均为nil。而Lua则将nil作为界定数据结尾的标志。当一个数组含有&ldquo;空隙&rdquo;时，即中间含有nil值，长度操作符#会认为这些nil元素就是结尾标志。当然这肯定不是我们想要的结果。因此对于这些含有&ldquo;空隙&rdquo;的数组，我们可以通过函数table.maxn()返回table的最大正数索引值。如：</p>
<div class="cnblogs_code">
<pre>a = {}<br />a[<span style="color: rgba(128, 0, 128, 1);">1000</span>] = <span style="color: rgba(128, 0, 128, 1);">1</span><br /><span style="color: rgba(255, 0, 255, 1);">print</span>(<span style="color: rgba(255, 0, 255, 1);">table.maxn</span>(a))    <br /><br /><span style="color: rgba(0, 128, 0, 1);">--</span><span style="color: rgba(0, 128, 0, 1);"> 输出1000</span></pre>
</div>
<p><br />&nbsp;&nbsp;&nbsp; <span style="font-size: 15px; color: rgba(128, 0, 128, 1);">6. function(函数)：</span><br />&nbsp;&nbsp; &nbsp;在Lua中，函数可以存储在变量中，可以通过参数传递其它函数，还可以作为其它函数的返回值。这种特性使语言具有了极大的灵活性。<br /><br />&nbsp;&nbsp;&nbsp; <span style="color: rgba(128, 0, 128, 1); font-size: 15px;">7. userdata(自定义类型)：</span><br />&nbsp;&nbsp; &nbsp;由于userdata类型可以将任意C语言数据存储到Lua变量中。在Lua中，这种类型没有太多预定义的操作，只能进行赋值和相等性测试。userdata用于表示一种由应用程序或C语言库所创建的新类型。</p>
</p>

                            </div>
                        </article>
                    </div>
                </div>
            </div>
          <footer id="colophon" role="contentinfo">
	<div id="site-generator">孙悟空 from 吉林大学自动化 @ sunwukong@sangkeji.com</div>
	<script src="../../../footer.js"></script>
          </footer>
        </div>
    </body>
</html>
